<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Biof√≠sica UACH - Objeto 3: L√≠pidos y Transporte (Versi√≥n Completa)</title>
<script src="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/js/all.min.js"></script>
<style>
    /* =========================================
       ESTILOS GENERALES Y VARIABLES
       ========================================= */
    :root {
        --color-primary: #7f1d1d; /* Rojo UACH */
        --color-primary-dark: #991b1b;
        --color-bg: #f3f4f6;
        --color-sat: #15803d; /* Verde */
        --color-cis: #2563eb; /* Azul */
        --color-trans: #dc2626; /* Rojo Alerta */
        --color-chol: #7c3aed; /* P√∫rpura */
        --card-shadow: 0 4px 6px -1px rgba(0,0,0,0.1), 0 2px 4px -1px rgba(0,0,0,0.06);
    }

    * {margin:0;padding:0;box-sizing:border-box}
    body {font-family:system-ui,-apple-system,sans-serif;background:var(--color-bg);color:#111827;line-height:1.6}
    .container {max-width:1200px;margin:0 auto;padding:0 1rem}
    .hidden {display:none !important}

    /* Loading Overlay */
    .loading {position:fixed;inset:0;background:#f3f4f6;display:flex;align-items:center;justify-content:center;z-index:100;flex-direction:column;gap:1rem}
    .spinner {width:50px;height:50px;border:5px solid var(--color-primary);border-top-color:transparent;border-radius:50%;animation:spin 1s linear infinite}
    @keyframes spin {to{transform:rotate(360deg)}}

    /* Navbar */
    .navbar {position:fixed;top:0;left:0;right:0;background:white;border-bottom:1px solid #e5e7eb;z-index:50;box-shadow:0 1px 3px rgba(0,0,0,0.1)}
    .navbar-content {display:flex;justify-content:space-between;align-items:center;height:4rem;padding:0 1rem}
    .brand {display:flex;align-items:center;gap:0.75rem}
    .brand-icon {width:2.5rem;height:2.5rem;background:var(--color-primary);color:white;border-radius:0.5rem;display:flex;align-items:center;justify-content:center;font-size:1.25rem}
    .brand-text h1 {font-size:0.875rem;font-weight:700;color:#111827}
    .brand-text p {font-size:0.75rem;color:#6b7280}

    /* Stats Header */
    .stats {display:flex;gap:1rem;align-items:center}
    .stat-item {text-align:center;padding:0.5rem;background:#f9fafb;border-radius:0.5rem;min-width:4rem}
    .stat-value {font-size:1.25rem;font-weight:700;color:var(--color-primary)}
    .stat-label {font-size:0.625rem;color:#6b7280;text-transform:uppercase}
    .progress {width:8rem}
    .progress-bar {height:0.5rem;background:#e5e7eb;border-radius:9999px;overflow:hidden;margin-top:0.25rem}
    .progress-fill {height:100%;background:var(--color-primary);transition:width 0.5s cubic-bezier(0.4, 0, 0.2, 1);width:0%}

    /* Main Content */
    main {padding-top:5rem;padding-bottom:5rem}
    .hero {background:linear-gradient(135deg,var(--color-primary),#991b1b);color:white;padding:2rem;border-radius:1rem;margin-bottom:2rem;position:relative;overflow:hidden; box-shadow: var(--card-shadow);}
    .hero-content {position:relative;z-index:1}
    .hero h2 {font-size:1.875rem;font-weight:700;margin-bottom:0.5rem}

    /* Tabs */
    .tabs {display:flex;gap:0.5rem;margin-bottom:2rem;background:white;padding:0.5rem;border-radius:0.75rem;box-shadow:0 1px 3px rgba(0,0,0,0.1);overflow-x:auto}
    .tab {padding:0.75rem 1rem;border-radius:0.5rem;cursor:pointer;white-space:nowrap;font-size:0.9rem;font-weight:600;color:#6b7280;transition:all 0.2s}
    .tab:hover {background:#f3f4f6;color:var(--color-primary)}
    .tab.active {background:var(--color-primary);color:white}

    /* Cards */
    .card {background:white;border-radius:0.75rem;box-shadow:var(--card-shadow);border:1px solid #e5e7eb;margin-bottom:1.5rem;overflow:hidden}
    .card-header {padding:1rem 1.5rem;border-bottom:1px solid #e5e7eb;background:#f9fafb;font-weight:700;display:flex;align-items:center;gap:0.5rem}

    /* =========================================
       ESTILOS DEL SIMULADOR 1 (MEMBRANA)
       ========================================= */
    .simulator-grid {display: grid; grid-template-columns: 1fr 1fr; gap: 1.5rem; padding: 1.5rem;}
    .lipid-selector {display: grid; grid-template-columns: repeat(auto-fit, minmax(100px, 1fr)); gap: 0.5rem; padding: 1rem;}
    .lipid-btn {padding: 0.75rem; border: 2px solid #e5e7eb; border-radius: 0.75rem; background: white; cursor: pointer; transition: all 0.2s; text-align: center; font-size: 0.75rem; font-weight: 500; display: flex; flex-direction: column; align-items: center; gap:0.5rem;}
    .lipid-btn:hover {border-color: #cbd5e1;}
    .lipid-btn.active {border-color: var(--color-primary); background: #fef2f2; box-shadow: 0 0 0 2px rgba(127,29,29,0.1);}
    
    .structure-viewer {min-height: 250px; background: #fafafa; border-radius: 0.75rem; padding: 1rem; border: 2px solid #e5e7eb; display: flex; justify-content: center; align-items: center;}
    
    .membrane-simulation {height: 300px; background: linear-gradient(to bottom, #dbeafe, white, #dbeafe); border-radius: 0.75rem; padding: 1rem; position: relative; overflow: hidden; border: 2px solid #e5e7eb;}
    .bilayer {height: 100%; display: flex; flex-direction: column; justify-content: center; align-items: center; gap: 4px;}
    .layer {display: flex; justify-content: center; align-items: flex-end; gap: 2px; height: 100px; width: 100%;}
    .layer.upper {transform: scaleY(-1);}
    
    /* Molecules Animation */
    .lipid-molecule {display: flex; flex-direction: column; align-items: center; width: 22px; position: relative; transform-origin: top center;}
    .head {width: 16px; height: 16px; border-radius: 50%; margin-bottom: -2px; z-index: 2; background: radial-gradient(circle, #fbbf24, #d97706);}
    .tail-container {width: 100%; display: flex; justify-content: center; gap: 2px;}
    .tail {width: 4px; height: 60px; border-radius: 3px; position: relative; opacity: 0.9;}
    .tail.straight {background: linear-gradient(to bottom, var(--color-sat), #14532d);}
    .tail.cis {background: linear-gradient(135deg, var(--color-cis), #1e3a8a); border-radius: 0 0 10px 10px; transform: rotate(-15deg) translateX(-5px); height: 50px;}
    .tail.trans {background: linear-gradient(to bottom, var(--color-trans), #7f1d1d);}
    .tail.cholesterol {height: 35px; width: 8px; background: var(--color-chol); margin-top: 10px; border-radius: 4px;}

    @keyframes sway { 0% { transform: rotate(-5deg); } 50% { transform: rotate(5deg); } 100% { transform: rotate(-5deg); } }
    @keyframes vibrate { 0% { transform: translateX(-1px); } 50% { transform: translateX(1px); } 100% { transform: translateX(-1px); } }
    .fluid-high .tail-container { animation: sway 1s infinite ease-in-out; }
    .fluid-med .tail-container { animation: sway 3s infinite ease-in-out; }
    .fluid-low .tail-container { animation: vibrate 0.1s infinite linear; }

    /* Nervous System Panel */
    .nervous-system-panel {background: linear-gradient(135deg, #fef3c7, #fef9c3); border: 2px solid #fbbf24; border-radius: 1rem; padding: 1.5rem; margin: 0 1.5rem 1.5rem 1.5rem;}
    .effects-grid {display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 1rem; margin-top: 1rem;}
    .effect-card {background: white; padding: 1rem; border-radius: 0.5rem; border-left: 4px solid #f59e0b; box-shadow: 0 2px 4px rgba(0,0,0,0.05);}
    .effect-card.severe {border-left-color: #ef4444;}

    /* =========================================
       ESTILOS DEL SIMULADOR 2 (LIPOPROTE√çNAS - NUEVO)
       ========================================= */
    .lipoprotein-stage {
        background: #0f172a; /* Fondo oscuro espacial */
        border-radius: 1rem;
        padding: 2rem;
        position: relative;
        height: 350px;
        display: flex;
        justify-content: center;
        align-items: center;
        overflow: hidden;
        margin: 1.5rem;
        box-shadow: inset 0 0 50px rgba(0,0,0,0.5);
    }
    .lipoprotein-core {
        width: 180px;
        height: 180px;
        background: radial-gradient(circle, #fde047 0%, #ca8a04 100%); /* N√∫cleo */
        border-radius: 50%;
        position: relative;
        border: 4px solid #4ade80; /* Capa fosfol√≠pidos */
        box-shadow: 0 0 30px rgba(74, 222, 128, 0.3);
        transition: all 0.6s cubic-bezier(0.34, 1.56, 0.64, 1); /* Rebote */
        display: flex;
        justify-content: center;
        align-items: center;
    }
    .apoprotein {
        position: absolute;
        background: #ef4444;
        border-radius: 10px;
        color: white;
        font-size: 0.7rem;
        font-weight: bold;
        padding: 4px 8px;
        z-index: 5;
        box-shadow: 2px 2px 4px rgba(0,0,0,0.5);
        white-space: nowrap;
    }
    .lp-label {
        position: absolute;
        bottom: 15px;
        left: 15px;
        color: white;
        background: rgba(255,255,255,0.1);
        backdrop-filter: blur(4px);
        padding: 5px 12px;
        border-radius: 20px;
        font-size: 0.9rem;
        border: 1px solid rgba(255,255,255,0.2);
    }
    .component-legend {
        display: flex;
        flex-wrap: wrap;
        gap: 1rem;
        font-size: 0.8rem;
        padding: 0 1.5rem 1.5rem 1.5rem;
        justify-content: center;
    }
    .legend-item { display: flex; align-items: center; gap: 0.5rem; }
    .dot { width: 12px; height: 12px; border-radius: 50%; border: 1px solid rgba(0,0,0,0.1); }

    /* ESTILOS DE LA TABLA COMPARATIVA */
    .lp-details {
        margin: 0 1.5rem 1.5rem 1.5rem;
        border: 1px solid #e5e7eb;
        border-radius: 0.5rem;
        overflow: hidden;
    }
    .lp-summary {
        padding: 1rem;
        background: #f8fafc;
        font-weight: 600;
        cursor: pointer;
        display: flex;
        align-items: center;
        gap: 0.5rem;
        color: #1e40af;
    }
    .lp-summary:hover { background: #f1f5f9; }
    .lp-table-container {
        overflow-x: auto;
        padding: 1rem;
        background: white;
    }
    .lp-table {
        width: 100%;
        border-collapse: collapse;
        font-size: 0.8rem;
        min-width: 600px;
    }
    .lp-table th, .lp-table td {
        padding: 0.75rem;
        border-bottom: 1px solid #e5e7eb;
        text-align: left;
    }
    .lp-table th {
        background-color: #eff6ff;
        color: #1e3a8a;
        font-weight: 700;
        position: sticky;
        left: 0;
    }
    .lp-table tr:nth-child(even) { background-color: #f9fafb; }
    .lp-table tr:hover { background-color: #f0f9ff; }

    /* =========================================
       UI ELEMENTS: QUIZ, DRAG, ETC.
       ========================================= */
    .quiz-container {padding:1.5rem}
    .quiz-question {margin-bottom:2rem; background: #fff; padding: 1.5rem; border-radius: 0.5rem; box-shadow: 0 2px 4px rgba(0,0,0,0.05); border: 1px solid #f3f4f6;}
    .quiz-q {font-weight:700;margin-bottom:1rem;font-size:1.1rem; color: #1f2937;}
    .quiz-option {padding:1rem;border:2px solid #e5e7eb;border-radius:0.5rem;cursor:pointer;transition:all 0.2s;background:white; margin-bottom: 0.5rem;}
    .quiz-option:hover {border-color:var(--color-primary);background:#fef2f2}
    .quiz-option.correct {border-color:#22c55e;background:#f0fdf4}
    .quiz-option.incorrect {border-color:#ef4444;background:#fef2f2}
    .quiz-feedback {margin-top:1rem;padding:1rem;border-radius:0.5rem;font-size:0.9rem}
    .quiz-feedback.correct {background:#f0fdf4;border:1px solid #86efac;color:#166534}
    .quiz-feedback.incorrect {background:#fef2f2;border:1px solid #fca5a5;color:#991b1b}

    /* Drag & Drop */
    .drag-drop-zone {padding:1.5rem}
    .drop-zones {display:grid;grid-template-columns:repeat(auto-fit,minmax(200px,1fr));gap:1rem;margin-bottom:1.5rem}
    .drop-zone {min-height:250px;padding:1rem;border:2px dashed #d1d5db;border-radius:0.75rem;background:#fafafa; display: flex; flex-direction: column;}
    .drop-zone-title {font-weight:700;margin-bottom:0.75rem;color:#374151;text-align:center;padding-bottom:0.5rem;border-bottom:2px solid #e5e7eb}
    .drop-zone.over {border-color:var(--color-primary);background:#fef2f2}
    .draggables {display:flex;flex-wrap:wrap;gap:0.75rem;padding:1rem;background:#f9fafb;border-radius:0.5rem;margin-bottom:1rem}
    .draggable {padding:0.5rem 0.75rem;background:white;border:1px solid #d1d5db;border-radius:0.5rem;cursor:grab;font-size:0.85rem;font-weight:600; box-shadow: 0 1px 2px rgba(0,0,0,0.05);}
    .draggable.placed {background:#f0fdf4;border-color:#86efac; cursor: default;}

    /* Inputs & Textareas */
    textarea {width:100%;padding:1rem;border:1px solid #d1d5db;border-radius:0.5rem;font-family:inherit;font-size:0.9rem;resize:vertical;min-height:100px; transition: border 0.2s;}
    textarea:focus {outline:none;border-color:var(--color-primary);box-shadow:0 0 0 3px rgba(127,29,29,0.1)}
    .question-item {margin-bottom:2rem;padding-left:1rem;border-left:4px solid #e5e7eb;}
    .question-item.completed {border-left-color: #22c55e;}

    /* Flashcards */
    .flashcard-grid {display:grid;grid-template-columns:repeat(auto-fit,minmax(250px,1fr));gap:1.5rem}
    .flashcard {background:white;border:1px solid #e5e7eb;border-radius:1rem;padding:2rem;text-align:center;cursor:pointer;transition:transform 0.6s;transform-style:preserve-3d;position:relative;height:220px;perspective:1000px;}
    .flashcard-inner {position: relative; width: 100%; height: 100%; text-align: center; transition: transform 0.6s; transform-style: preserve-3d; }
    .flashcard:hover .flashcard-inner { transform: rotateY(10deg); }
    .flashcard.flipped .flashcard-inner { transform: rotateY(180deg); }
    .flashcard-front, .flashcard-back { position: absolute; width: 100%; height: 100%; -webkit-backface-visibility: hidden; backface-visibility: hidden; display: flex; align-items: center; justify-content: center; flex-direction: column; padding: 1rem; border-radius: 1rem; }
    .flashcard-front { background-color: #fff; color: black; }
    .flashcard-back { background-color: #fef2f2; color: #7f1d1d; transform: rotateY(180deg); border: 1px solid var(--color-primary); }

    /* Save UI */
    .save-system-fab {position:fixed;bottom:2rem;right:2rem;z-index:90;}
    .fab-button {width:3.5rem;height:3.5rem;border-radius:50%;background:var(--color-primary);color:white;border:none;box-shadow:0 4px 12px rgba(0,0,0,0.3);cursor:pointer;display:flex;align-items:center;justify-content:center;font-size:1.5rem;transition:transform 0.2s;}
    .fab-button:hover {transform:scale(1.1);}
    .save-menu {position:absolute;bottom:4.5rem;right:0;width:280px;background:white;border-radius:0.75rem;box-shadow:0 10px 25px -5px rgba(0,0,0,0.2);padding:1rem;display:none;}
    .save-menu.show {display:block;}
    .save-action-btn {width:100%;text-align:left;padding:0.75rem;background:white;border:1px solid #e5e7eb;border-radius:0.5rem;margin-bottom:0.5rem;cursor:pointer;display:flex;align-items:center;gap:0.75rem;transition:background 0.2s;}
    .save-action-btn:hover {background:#f9fafb;}

    /* Achievement Bar */
    .achievement-bar {padding:1rem;background:white;border-radius:0.75rem;margin-bottom:1rem; border: 1px solid #e5e7eb;}
    .achievement-list {display:flex;gap:0.5rem;flex-wrap:wrap;margin-top:0.5rem}
    .achievement {padding:0.5rem 0.75rem;background:#f3f4f6;border-radius:0.5rem;font-size:0.75rem;display:flex;align-items:center;gap:0.5rem;opacity:0.6; filter: grayscale(1);}
    .achievement.unlocked {background:#fef3c7;border-color:#fcd34d;opacity:1; filter: grayscale(0); font-weight: bold; color: #92400e;}

    /* Modal */
    .modal {display:none;position:fixed;inset:0;background:rgba(0,0,0,0.5);z-index:100;align-items:center;justify-content:center}
    .modal.show {display:flex}
    .modal-content {background:white;border-radius:1rem;padding:2rem;max-width:500px;margin:1rem;box-shadow:0 20px 25px -5px rgba(0,0,0,0.3);text-align: center; animation: slideIn 0.3s ease-out;}
    @keyframes slideIn { from { transform: translateY(20px); opacity: 0; } to { transform: translateY(0); opacity: 1; } }
    .btn {padding: 0.625rem 1.25rem; border-radius: 0.5rem; cursor: pointer; border: none; font-weight: 600; background: var(--color-primary); color: white;}
    .btn:hover {background: var(--color-primary-dark);}

    @media (max-width: 768px) {
        .simulator-grid, .comparison-grid {grid-template-columns:1fr}
        .stats {display:none}
        .save-system-fab {bottom: 1rem; right: 1rem;}
        .drop-zones {grid-template-columns: 1fr;}
    }
</style>
</head>
<body>

<div id="loading" class="loading">
    <div class="spinner"></div>
    <p style="font-weight:600; margin-top:1rem;">Cargando Laboratorio Biof√≠sico...</p>
</div>

<!-- Notification Toast -->
<div id="save-notification" style="position:fixed;bottom:2rem;left:50%;transform:translateX(-50%);background:rgba(31, 41, 55, 0.95);color:white;padding:0.75rem 1.5rem;border-radius:9999px;font-size:0.875rem;z-index:100;opacity:0;pointer-events:none;transition:opacity 0.3s;">
    <i class="fas fa-check-circle"></i> <span id="save-message">Progreso guardado</span>
</div>

<div id="app" class="hidden">
    <!-- Navegaci√≥n Superior -->
    <nav class="navbar">
        <div class="navbar-content">
            <div class="brand">
                <div class="brand-icon"><i class="fas fa-dna"></i></div>
                <div class="brand-text">
                    <h1>Biof√≠sica UACH</h1>
                    <p>Objeto 3: L√≠pidos y Transporte</p>
                </div>
            </div>
            <div class="stats">
                <div class="stat-item">
                    <div class="stat-value" id="stat-points">0</div>
                    <div class="stat-label">Puntos</div>
                </div>
                <div class="stat-item">
                    <div class="stat-value" id="stat-badges">0/10</div>
                    <div class="stat-label">Medallas</div>
                </div>
                <div class="progress">
                    <div style="font-size:0.75rem;color:#6b7280;margin-bottom:2px">Progreso</div>
                    <div class="progress-bar"><div id="progress-fill" class="progress-fill"></div></div>
                </div>
            </div>
        </div>
    </nav>

    <!-- Men√∫ Flotante de Guardado -->
    <div class="save-system-fab">
        <div class="save-menu" id="save-menu">
            <div style="font-weight:700;color:#374151;margin-bottom:0.75rem;border-bottom:1px solid #e5e7eb;padding-bottom:0.5rem;display:flex;justify-content:space-between;">
                <span>Opciones de Guardado</span>
                <i class="fas fa-times" style="cursor:pointer" onclick="toggleSaveMenu()"></i>
            </div>
            <button class="save-action-btn" onclick="saveSystem.forceSave()"><i class="fas fa-save"></i> Guardar Progreso</button>
            <button class="save-action-btn" onclick="saveSystem.downloadBackup()"><i class="fas fa-download"></i> Descargar Respaldo</button>
            <button class="save-action-btn" onclick="document.getElementById('backup-upload').click()"><i class="fas fa-upload"></i> Cargar Respaldo</button>
            <input type="file" id="backup-upload" style="display:none" accept=".json" onchange="saveSystem.restoreBackup(this)">
            <button class="save-action-btn" style="color:#ef4444;border-color:#fca5a5" onclick="saveSystem.clearProgress()"><i class="fas fa-trash"></i> Reiniciar Todo</button>
            <div style="text-align:center;font-size:0.75rem;color:#6b7280;margin-top:0.5rem" id="menu-last-save">--</div>
        </div>
        <button class="fab-button" onclick="toggleSaveMenu()" title="Guardar"><i class="fas fa-save"></i></button>
    </div>

    <main class="container">
        <!-- Hero -->
        <div class="hero">
            <div class="hero-content">
                <h2><i class="fas fa-atom"></i> Laboratorio de L√≠pidos y Membranas</h2>
                <p>Completa las actividades, simula estructuras moleculares y domina el transporte de l√≠pidos.</p>
            </div>
        </div>

        <!-- Barra de Logros -->
        <div class="achievement-bar">
            <div style="font-weight:700;font-size:0.9rem;color:#374151"><i class="fas fa-trophy"></i> Tus Logros</div>
            <div class="achievement-list">
                <div class="achievement" id="ach-1"><span>üéì</span> Iniciado</div>
                <div class="achievement" id="ach-2"><span>üìö</span> Estudioso</div>
                <div class="achievement" id="ach-3"><span>‚ö°</span> Perfecto</div>
                <div class="achievement" id="ach-4"><span>üéØ</span> Clasificador</div>
                <div class="achievement" id="ach-5"><span>üß™</span> Biof√≠sico</div>
                <div class="achievement" id="ach-6"><span>üíØ</span> 50% Camino</div>
                <div class="achievement" id="ach-7"><span>üî¨</span> Analista</div>
                <div class="achievement" id="ach-8"><span>üöÄ</span> Experto</div>
                <div class="achievement" id="ach-9"><span>üöõ</span> Transportista</div>
                <div class="achievement" id="ach-10"><span>‚≠ê</span> Maestro</div>
            </div>
        </div>

        <!-- Pesta√±as de Navegaci√≥n -->
        <div class="tabs">
            <div class="tab active" onclick="showTab('quizzes')"><i class="fas fa-list-ol"></i> Quizzes (50)</div>
            <div class="tab" onclick="showTab('simulator')"><i class="fas fa-flask"></i> Simuladores 3D</div>
            <div class="tab" onclick="showTab('drag-drop')"><i class="fas fa-hand-rock"></i> Clasificar</div>
            <div class="tab" onclick="showTab('ejercicios')"><i class="fas fa-pen-fancy"></i> Ejercicios (Completo)</div>
            <div class="tab" onclick="showTab('calculator')"><i class="fas fa-calculator"></i> Calculadoras</div>
            <div class="tab" onclick="showTab('flashcards')"><i class="fas fa-clone"></i> Flashcards</div>
        </div>

        <!-- CONTENIDO: QUIZZES -->
        <div id="tab-quizzes" class="tab-content">
            <div class="card">
                <div class="card-header" style="color:#1e40af;background:#eff6ff"><i class="fas fa-question-circle"></i> Evaluaci√≥n de Conocimientos</div>
                <div class="quiz-container" id="quiz-container">
                    <!-- JS generar√° las preguntas aqu√≠ -->
                </div>
            </div>
        </div>

        <!-- CONTENIDO: SIMULADOR (MEMBRANAS + LIPOPROTE√çNAS) -->
        <div id="tab-simulator" class="tab-content hidden">
            <!-- Secci√≥n 1: Membranas -->
            <div class="card">
                <div class="card-header" style="background:#f0fdf4;color:#166534">
                    <i class="fas fa-microscope"></i> Fluidez de Membrana
                </div>
                <div class="lipid-selector">
                    <button class="lipid-btn active" onclick="lipidSim.selectLipid('saturado')" id="btn-saturado">
                        <i class="fas fa-ruler-horizontal" style="color:var(--color-sat)"></i> Saturado
                    </button>
                    <button class="lipid-btn" onclick="lipidSim.selectLipid('cis')" id="btn-cis">
                        <i class="fas fa-wave-square" style="color:var(--color-cis)"></i> Cis (Natural)
                    </button>
                    <button class="lipid-btn" onclick="lipidSim.selectLipid('trans')" id="btn-trans">
                        <i class="fas fa-exclamation-triangle" style="color:var(--color-trans)"></i> Trans (Ind)
                    </button>
                    <button class="lipid-btn" onclick="lipidSim.selectLipid('colesterol')" id="btn-colesterol">
                        <i class="fas fa-gem" style="color:var(--color-chol)"></i> Colesterol
                    </button>
                    <button class="lipid-btn" onclick="lipidSim.selectLipid('mixto')" id="btn-mixto">
                        <i class="fas fa-layer-group"></i> Membrana Real
                    </button>
                </div>
                
                <div class="simulator-grid">
                    <div>
                        <h4 style="margin-bottom:0.5rem;font-size:0.85rem;color:#6b7280;text-transform:uppercase">Estructura Molecular</h4>
                        <div class="structure-viewer">
                            <svg id="structure-svg" viewBox="0 0 300 250" style="width:100%;height:100%"></svg>
                        </div>
                        <div id="lipid-info" style="margin-top:0.5rem"></div>
                    </div>
                    <div>
                        <h4 style="margin-bottom:0.5rem;font-size:0.85rem;color:#6b7280;text-transform:uppercase">Comportamiento Bicapa</h4>
                        <div class="membrane-simulation">
                            <div class="bilayer" id="bilayer"></div>
                        </div>
                        <div style="display:flex;justify-content:space-between;align-items:center;margin-top:0.5rem;font-size:0.8rem">
                            <strong>Fluidez:</strong>
                            <div style="width:60%;height:6px;background:#e5e7eb;border-radius:3px">
                                <div id="fluidity-meter" style="width:0%;height:100%;background:var(--color-primary);transition:width 0.5s"></div>
                            </div>
                            <span id="fluidity-val">--</span>
                        </div>
                    </div>
                </div>

                <!-- Panel SN -->
                <div class="nervous-system-panel">
                    <h3 style="color:#92400e;margin-bottom:0.5rem"><i class="fas fa-brain"></i> Impacto en el Sistema Nervioso</h3>
                    <p style="font-size:0.9rem;color:#4b5563">La fluidez de membrana es vital. El exceso de grasas trans o saturadas rigidiza las membranas neuronales, afectando la transmisi√≥n sin√°ptica.</p>
                    <div class="effects-grid">
                        <div class="effect-card severe">
                            <h4><i class="fas fa-bolt"></i> Mielina R√≠gida</h4>
                            <p style="font-size:0.8rem">Fallo en el aislamiento el√©ctrico del ax√≥n.</p>
                        </div>
                        <div class="effect-card">
                            <h4><i class="fas fa-traffic-light"></i> Receptores</h4>
                            <p style="font-size:0.8rem">Incapacidad de moverse para captar neurotransmisores.</p>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Secci√≥n 2: Lipoprote√≠nas (NUEVO) -->
            <div class="card" style="border: 2px solid #3b82f6;">
                <div class="card-header" style="background:#eff6ff; color:#1e40af;">
                    <i class="fas fa-shuttle-van"></i> Din√°mica de Lipoprote√≠nas (Transporte Sangu√≠neo)
                </div>
                <div style="padding: 1rem;">
                    <p style="font-size: 0.9rem; color: #4b5563; margin-bottom: 1rem; text-align:center">
                        Las lipoprote√≠nas son los "veh√≠culos" que transportan l√≠pidos en la sangre. Selecciona una:
                    </p>
                    
                    <div class="lipid-selector">
                        <button class="lipid-btn" onclick="lpSim.update('chylomicron')" id="btn-lp-chy">
                            <i class="fas fa-hamburger" style="color: #fbbf24; font-size:1.5rem"></i> <span>Quilomicr√≥n</span>
                        </button>
                        <button class="lipid-btn" onclick="lpSim.update('vldl')" id="btn-lp-vldl">
                            <i class="fas fa-truck" style="color: #f59e0b; font-size:1.5rem"></i> <span>VLDL</span>
                        </button>
                        <button class="lipid-btn" onclick="lpSim.update('ldl')" id="btn-lp-ldl">
                            <i class="fas fa-skull-crossbones" style="color: #ef4444; font-size:1.5rem"></i> <span>LDL (Malo)</span>
                        </button>
                        <button class="lipid-btn" onclick="lpSim.update('hdl')" id="btn-lp-hdl">
                            <i class="fas fa-shield-alt" style="color: #22c55e; font-size:1.5rem"></i> <span>HDL (Bueno)</span>
                        </button>
                    </div>
        
                    <div class="lipoprotein-stage">
                        <div class="lipoprotein-core" id="lp-core">
                            <!-- Apoprote√≠nas generadas din√°micamente -->
                        </div>
                        <div class="lp-label" id="lp-name">Selecciona un veh√≠culo</div>
                    </div>
        
                    <div class="component-legend">
                        <div class="legend-item"><span class="dot" style="background:#ca8a04"></span> Triglic√©ridos (N√∫cleo)</div>
                        <div class="legend-item"><span class="dot" style="background:#4ade80"></span> Fosfol√≠pidos (Corteza)</div>
                        <div class="legend-item"><span class="dot" style="background:#ef4444"></span> Apoprote√≠nas</div>
                        <div class="legend-item"><span class="dot" style="background:#fde047"></span> Colesterol</div>
                    </div>
                    
                    <div id="lp-desc" class="info-panel" style="background:#f8fafc; padding:1rem; border-radius:0.5rem; border-left:4px solid #3b82f6; font-size: 0.9rem; margin-bottom: 1.5rem;">
                        Explora los diferentes tipos de transporte lip√≠dico usando los botones superiores.
                    </div>
                </div>

                <!-- Tabla Comparativa Desplegable -->
                <details class="lp-details">
                    <summary class="lp-summary">
                        <i class="fas fa-table"></i> Ver Tabla Comparativa Detallada
                    </summary>
                    <div class="lp-table-container">
                        <table class="lp-table">
                            <thead>
                                <tr>
                                    <th>Caracter√≠stica</th>
                                    <th>Quilomicr√≥n</th>
                                    <th>VLDL</th>
                                    <th>IDL</th>
                                    <th>LDL</th>
                                    <th>HDL</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td><strong>Densidad (g/mL)</strong></td>
                                    <td>< 0.95</td>
                                    <td>0.95 - 1.006</td>
                                    <td>1.006 - 1.019</td>
                                    <td>1.019 - 1.063</td>
                                    <td>1.063 - 1.210</td>
                                </tr>
                                <tr>
                                    <td><strong>Di√°metro (nm)</strong></td>
                                    <td>75 - 1200</td>
                                    <td>30 - 80</td>
                                    <td>25 - 35</td>
                                    <td>18 - 25</td>
                                    <td>5 - 12</td>
                                </tr>
                                <tr>
                                    <td><strong>Prote√≠na (%)</strong></td>
                                    <td>1 - 2</td>
                                    <td>10</td>
                                    <td>18</td>
                                    <td>25</td>
                                    <td>40 - 55</td>
                                </tr>
                                <tr>
                                    <td><strong>Colesterol Libre (%)</strong></td>
                                    <td>1 - 3</td>
                                    <td>7</td>
                                    <td>9</td>
                                    <td>8</td>
                                    <td>3 - 4</td>
                                </tr>
                                <tr>
                                    <td><strong>√âsteres de Col. (%)</strong></td>
                                    <td>3 - 5</td>
                                    <td>12</td>
                                    <td>29</td>
                                    <td>42</td>
                                    <td>15 - 20</td>
                                </tr>
                                <tr>
                                    <td><strong>Triglic√©ridos (%)</strong></td>
                                    <td>85 - 95</td>
                                    <td>50 - 65</td>
                                    <td>22</td>
                                    <td>6</td>
                                    <td>3 - 5</td>
                                </tr>
                                <tr>
                                    <td><strong>Fosfol√≠pidos (%)</strong></td>
                                    <td>3 - 6</td>
                                    <td>15 - 20</td>
                                    <td>19</td>
                                    <td>22</td>
                                    <td>25 - 30</td>
                                </tr>
                                <tr>
                                    <td><strong>Apolipoprote√≠nas</strong></td>
                                    <td>A-I, A-II, B-48, C, E</td>
                                    <td>B-100, C, E</td>
                                    <td>B-100, E</td>
                                    <td>B-100</td>
                                    <td>A-I, A-II, C, E</td>
                                </tr>
                                <tr>
                                    <td><strong>Origen</strong></td>
                                    <td>Intestino</td>
                                    <td>H√≠gado</td>
                                    <td>De VLDL</td>
                                    <td>De IDL/VLDL</td>
                                    <td>H√≠gado/Intestino</td>
                                </tr>
                                <tr>
                                    <td><strong>Funci√≥n</strong></td>
                                    <td>Transporte l√≠pidos dieta</td>
                                    <td>Transporte TG end√≥genos</td>
                                    <td>Intermediario</td>
                                    <td>Transporte colesterol</td>
                                    <td>Transporte reverso</td>
                                </tr>
                                <tr>
                                    <td><strong>Vida Media</strong></td>
                                    <td>Minutos</td>
                                    <td>2-4 horas</td>
                                    <td>-</td>
                                    <td>2-3 d√≠as</td>
                                    <td>5-6 d√≠as</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </details>
            </div>
        </div>

        <!-- CONTENIDO: DRAG & DROP -->
        <div id="tab-drag-drop" class="tab-content hidden">
            <div class="card">
                <div class="card-header"><i class="fas fa-sort-amount-up"></i> Clasificaci√≥n de L√≠pidos</div>
                <div class="drag-drop-zone">
                    <p style="margin-bottom:1rem;font-size:0.9rem">Arrastra cada mol√©cula a su categor√≠a qu√≠mica correcta.</p>
                    <div class="draggables" id="draggables-container"></div>
                    <div class="drop-zones">
                        <div class="drop-zone" data-category="acidos_grasos">
                            <div class="drop-zone-title">√Åcidos Grasos</div><div class="drop-items"></div>
                        </div>
                        <div class="drop-zone" data-category="membrana">
                            <div class="drop-zone-title">L√≠pidos de Membrana</div><div class="drop-items"></div>
                        </div>
                        <div class="drop-zone" data-category="esteroides">
                            <div class="drop-zone-title">Esteroides/Isoprenoides</div><div class="drop-items"></div>
                        </div>
                        <div class="drop-zone" data-category="almacenamiento">
                            <div class="drop-zone-title">TAGs y Ceras</div><div class="drop-items"></div>
                        </div>
                    </div>
                    <button class="btn" onclick="checkDragDrop()">Verificar Clasificaci√≥n</button>
                </div>
            </div>
        </div>

        <!-- CONTENIDO: EJERCICIOS -->
        <div id="tab-ejercicios" class="tab-content hidden">
            <div id="preguntas-render-zone"></div>
        </div>

        <!-- CONTENIDO: CALCULADORA -->
        <div id="tab-calculator" class="tab-content hidden">
            <div class="card">
                <div class="card-header" style="color:#7c3aed;background:#faf5ff"><i class="fas fa-calculator"></i> Herramientas Biof√≠sicas</div>
                <div style="padding:1.5rem">
                    <!-- Iodine Calc -->
                    <div style="margin-bottom:2rem;border-bottom:1px solid #eee;padding-bottom:2rem">
                        <h3>1. √çndice de Yodo (Insaturaci√≥n)</h3>
                        <p style="font-size:0.85rem;color:#6b7280;margin-bottom:1rem">Determina el grado de insaturaci√≥n de un √°cido graso.</p>
                        <select id="calc-iodine-select" class="lipid-btn" style="width:100%;text-align:left;padding:0.5rem" onchange="calcIodine()">
                            <option value="">Selecciona un √°cido graso...</option>
                            <option value="0">√Åcido Este√°rico (18:0)</option>
                            <option value="0">√Åcido Palm√≠tico (16:0)</option>
                            <option value="90">√Åcido Oleico (18:1)</option>
                            <option value="181">√Åcido Linoleico (18:2)</option>
                            <option value="273">√Åcido Linol√©nico (18:3)</option>
                        </select>
                        <div id="iodine-result" style="margin-top:1rem;font-weight:bold;color:var(--color-primary)"></div>
                    </div>

                    <!-- Melting Point Calc -->
                    <div>
                        <h3>2. Estimador de Punto de Fusi√≥n</h3>
                        <div style="display:grid;grid-template-columns:1fr 1fr;gap:1rem;margin-top:1rem">
                            <div>
                                <label>Carbonos (C)</label>
                                <input type="number" id="mp-c" value="18" min="4" max="24" style="width:100%;padding:0.5rem;border:1px solid #ccc;border-radius:0.3rem" oninput="calcMP()">
                            </div>
                            <div>
                                <label>Dobles Enlaces</label>
                                <input type="number" id="mp-db" value="0" min="0" max="6" style="width:100%;padding:0.5rem;border:1px solid #ccc;border-radius:0.3rem" oninput="calcMP()">
                            </div>
                        </div>
                        <div style="margin-top:1rem">
                            <label>Configuraci√≥n:</label>
                            <select id="mp-cfg" style="padding:0.5rem;border-radius:0.3rem" onchange="calcMP()">
                                <option value="cis">Cis (Natural)</option>
                                <option value="trans">Trans (Industrial)</option>
                            </select>
                        </div>
                        <div id="mp-result" style="margin-top:1rem;padding:1rem;background:#f8fafc;border-radius:0.5rem;text-align:center">
                            <div id="mp-val" style="font-size:2rem;font-weight:bold">70¬∞C</div>
                            <div id="mp-state">S√≥lido</div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- CONTENIDO: FLASHCARDS -->
        <div id="tab-flashcards" class="tab-content hidden">
            <div class="flashcard-grid" id="flashcard-container"></div>
        </div>

    </main>
</div>

<!-- Modal Logros -->
<div id="achievement-modal" class="modal">
    <div class="modal-content">
        <div style="font-size:3rem;margin-bottom:1rem" id="modal-icon">üèÜ</div>
        <h2 id="modal-title" style="margin-bottom:0.5rem">¬°Logro Desbloqueado!</h2>
        <p id="modal-desc" style="color:#6b7280;margin-bottom:1.5rem">Descripci√≥n</p>
        <button class="btn" onclick="document.getElementById('achievement-modal').classList.remove('show')">¬°Genial!</button>
    </div>
</div>

<script>
/* =========================================
   BASE DE DATOS DE PREGUNTAS (COMPLETA)
   ========================================= */
const preguntasData = {
    "Preliminares": [
        "¬øQu√© caracter√≠sticas comunes cree usted que tienen sustancias como el aceite de cocina, la mantequilla y el colesterol para ser agrupadas como \"l√≠pidos\"?",
        "Mencione tres funciones que conozca de los l√≠pidos en el cuerpo humano.",
        "¬øQu√© diferencia cree que existe entre las grasas que son s√≥lidas a temperatura ambiente (como la manteca) y las que son l√≠quidas (como el aceite de oliva)?",
        "¬øHa escuchado hablar de las grasas \"buenas\" y \"malas\" (saturadas vs. insaturadas)? ¬øQu√© idea tiene sobre ellas?",
        "Todas nuestras c√©lulas est√°n rodeadas por una membrana. ¬øQu√© tipo de l√≠pidos cree que la forman y por qu√© son adecuados para esa funci√≥n?",
        "¬øQu√© son las vitaminas liposolubles? Mencione alguna que conozca.",
        "¬øPor qu√© cree que las grasas son una fuente de energ√≠a tan concentrada en comparaci√≥n con los carbohidratos?",
        "¬øQu√© entiende por el t√©rmino \"colesterol\"? ¬øEs siempre perjudicial para la salud?",
        "¬øC√≥mo cree que nuestro cuerpo digiere y absorbe las grasas que comemos, si la sangre es un medio acuoso donde las grasas no se disuelven?",
        "¬øHa o√≠do hablar de los √°cidos grasos omega-3 y omega-6? ¬øEn qu√© alimentos se encuentran com√∫nmente?"
    ],
    "3.1 Introducci√≥n y funciones": [
        "Defina qu√© son los l√≠pidos bas√°ndose en sus propiedades de solubilidad.",
        "Enumere y describa brevemente las diversas funciones que desempe√±an los l√≠pidos en los organismos vivos.",
        "Explique por qu√© los l√≠pidos son una forma eficiente de almacenamiento de energ√≠a en comparaci√≥n con los carbohidratos, como el gluc√≥geno.",
        "Clasifique los l√≠pidos en las 6 categor√≠as principales mencionadas en el texto de McKee.",
        "[APLICACI√ìN] El tejido adiposo, adem√°s de ser una reserva de energ√≠a, cumple una funci√≥n de aislamiento t√©rmico. Explique esta propiedad bas√°ndose en las caracter√≠sticas de los triacilgliceroles.",
        "[APLICACI√ìN] Algunas aves acu√°ticas cubren sus plumas con secreciones de gl√°ndulas especializadas. ¬øQu√© tipo de l√≠pidos esperar√≠a encontrar en estas secreciones y cu√°l es su funci√≥n?",
        "[APLICACI√ìN] Las vitaminas A, D, E y K se conocen como liposolubles. ¬øQu√© implica esto para su absorci√≥n y almacenamiento en el cuerpo? ¬øQu√© problemas podr√≠a causar una dieta extremadamente baja en grasas?"
    ],
    "3.2 √Åcidos grasos": [
        "Describa la estructura qu√≠mica general de un √°cido graso. Explique el sistema de numeraci√≥n y la designaci√≥n de los carbonos Œ±, Œ≤ y œâ (omega).",
        "¬øCu√°l es la diferencia estructural entre un √°cido graso saturado y uno insaturado?",
        "Explique c√≥mo la presencia de un doble enlace cis afecta la forma de la cadena hidrocarbonada de un √°cido graso.",
        "Relacione la estructura (saturaci√≥n y presencia de dobles enlaces cis) de los √°cidos grasos con sus propiedades f√≠sicas, como el punto de fusi√≥n.",
        "Defina los t√©rminos monoinsaturado y poliinsaturado.",
        "¬øQu√© son los √°cidos grasos esenciales? Nombre los dos principales para los humanos y explique por qu√© son esenciales.",
        "Explique la nomenclatura omega (œâ) para los √°cidos grasos insaturados, usando los √°cidos grasos omega-3 y omega-6 como ejemplos.",
        "[APLICACI√ìN] El √°cido este√°rico (18:0) es un s√≥lido a temperatura ambiente, mientras que el √°cido oleico (18:1Œî‚Åπ) es l√≠quido. Ambos tienen 18 carbonos. Explique esta diferencia.",
        "[APLICACI√ìN] Los aceites vegetales pueden convertirse en grasas s√≥lidas como la margarina mediante un proceso de hidrogenaci√≥n parcial. ¬øQu√© ocurre qu√≠micamente en este proceso y qu√© tipo de √°cidos grasos (un subproducto no deseado) se pueden formar?",
        "[APLICACI√ìN] Ordene los siguientes √°cidos grasos de menor a mayor punto de fusi√≥n y justifique su respuesta: a. √Åcido palm√≠tico (16:0) b. √Åcido linol√©nico (18:3Œî‚Åπ,¬π¬≤,¬π‚Åµ) c. √Åcido este√°rico (18:0) d. √Åcido oleico (18:1Œî‚Åπ)",
        "[APLICACI√ìN] El √°cido araquid√≥nico [20:4(5,8,11,14)] es precursor de los eicosanoides. ¬øEs un √°cido graso omega-3 o omega-6? Justifique su respuesta."
    ],
    "3.3 Triacilgliceroles y ceras": [
        "Describa la estructura de un triacilglicerol (TAG). ¬øQu√© mol√©culas lo componen y qu√© tipo de enlace las une?",
        "¬øPor qu√© los TAGs son considerados \"grasas neutras\" y son altamente hidrof√≥bicos?",
        "¬øCu√°l es la principal funci√≥n de los triacilgliceroles en los animales? Describa las c√©lulas especializadas en su almacenamiento.",
        "Diferencie entre grasas y aceites seg√∫n su estado f√≠sico a temperatura ambiente y su composici√≥n de √°cidos grasos.",
        "¬øQu√© es la saponificaci√≥n? Describa la reacci√≥n qu√≠mica que ocurre al tratar un triacilglicerol con una base fuerte como el NaOH.",
        "Describa la composici√≥n qu√≠mica general de las ceras. ¬øQu√© son los √©steres de cera?",
        "¬øCu√°l es la funci√≥n principal de las ceras en la naturaleza? Proporcione ejemplos en plantas y animales.",
        "[APLICACI√ìN] Un aceite vegetal, como el de ma√≠z, es l√≠quido a temperatura ambiente, mientras que la grasa animal, como la de res, es s√≥lida. ¬øQu√© puede inferir sobre la composici√≥n de √°cidos grasos de cada uno?",
        "[APLICACI√ìN] El proceso de digesti√≥n de grasas requiere que estas se emulsionen en el intestino. Explique c√≥mo el jab√≥n (sales de √°cidos grasos) act√∫a como agente emulsionante para dispersar gotas de aceite en agua, relacion√°ndolo con la digesti√≥n.",
        "[APLICACI√ìN] La cera de abejas es s√≥lida y completamente insoluble en agua, lo que permite que el panal sea impermeable. ¬øQu√© caracter√≠sticas estructurales de sus componentes (√©steres de cera) le confieren estas propiedades?"
    ],
    "3.4 Fosfol√≠pidos": [
        "Describa la naturaleza anfip√°tica de los fosfol√≠pidos. Identifique sus dominios hidrof√≥bico e hidrof√≠lico.",
        "Explique por qu√© los fosfol√≠pidos forman espont√°neamente una bicapa en un medio acuoso. ¬øQu√© fuerzas impulsan esta organizaci√≥n?",
        "¬øCu√°les son las dos clases principales de fosfol√≠pidos?",
        "Dibuje la estructura general de un fosfoglic√©rido. ¬øCu√°l es su mol√©cula precursora?",
        "Nombre al menos cuatro alcoholes que pueden esterificarse al grupo fosfato de un fosfoglic√©rido y los fosfol√≠pidos resultantes.",
        "¬øQu√© es la cardiolipina y en qu√© membrana celular se encuentra predominantemente? ¬øCu√°l es su funci√≥n?",
        "Describa el rol de la dipalmitoilfosfatidilcolina (DPPC) como componente principal del surfactante pulmonar. ¬øQu√© es el s√≠ndrome de dificultad respiratoria (RDS)?",
        "[APLICACI√ìN] La membrana plasm√°tica es fluida y semipermeable. Explique c√≥mo la composici√≥n de √°cidos grasos (saturados vs. insaturados) en los fosfol√≠pidos influye en la fluidez de la membrana.",
        "[APLICACI√ìN] El fosfatidilinositol 4,5-bifosfato (PIP2) es un fosfol√≠pido de membrana que act√∫a en la transducci√≥n de se√±ales. La enzima fosfolipasa C lo escinde. ¬øQu√© dos mol√©culas mensajeras se generan y cu√°l es su funci√≥n?",
        "[APLICACI√ìN] Las membranas biol√≥gicas son asim√©tricas en cuanto a su composici√≥n de fosfol√≠pidos. Por ejemplo, la fosfatidilserina (PS) se encuentra principalmente en la monocapa interna de la membrana plasm√°tica. ¬øQu√© importancia biol√≥gica tiene esta asimetr√≠a (p. ej., en la apoptosis)?",
        "[APLICACI√ìN] Las fosfolipasas son enzimas que degradan los fosfol√≠pidos. La fosfolipasa A2 (PLA2) es un componente del veneno de algunas serpientes. ¬øQu√© producto se libera por su acci√≥n sobre los fosfol√≠pidos de membrana y c√≥mo contribuye esto a la toxicidad del veneno?"
    ],
    "3.5 Esfingol√≠pidos": [
        "¬øCu√°l es la mol√©cula base (alcohol) de los esfingol√≠pidos, que reemplaza al glicerol?",
        "Defina el t√©rmino ceramida. ¬øQu√© componentes la forman y qu√© tipo de enlace los une?",
        "Describa la estructura de la esfingomielina. ¬øA qu√© clase de l√≠pidos pertenece? ¬øEn qu√© estructura del sistema nervioso es abundante?",
        "¬øQu√© son los glicoesfingol√≠pidos? ¬øEn qu√© se diferencian de la esfingomielina?",
        "Defina y diferencie los cerebr√≥sidos y los gangli√≥sidos bas√°ndose en su grupo de cabeza polar.",
        "¬øQu√© son las esfingolipidosis? Describa la causa de Tay-Sachs, mencionando la enzima deficiente y el l√≠pido que se acumula.",
        "[APLICACI√ìN] La vaina de mielina que a√≠sla los axones neuronales es rica en esfingomielina y galactocerebr√≥sidos. ¬øQu√© propiedades confieren estos l√≠pidos a la mielina?",
        "[APLICACI√ìN] Los gangli√≥sidos se encuentran en la superficie externa de las membranas celulares y act√∫an como receptores. Por ejemplo, la toxina del c√≥lera se une al gangli√≥sido GM1. Explique c√≥mo la porci√≥n de carbohidrato permite esto.",
        "[APLICACI√ìN] En la enfermedad de Gaucher, hay una deficiencia de Œ≤-glucosidasa. ¬øEn qu√© org√°nulo celular esperar√≠a que ocurriera la acumulaci√≥n de glucocerebr√≥sido y por qu√©?",
        "[APLICACI√ìN] Compare y contraste la estructura de la fosfatidilcolina con la de la esfingomielina. ¬øEn qu√© se diferencian sus \"esqueletos\"?"
    ],
    "3.6 Isoprenoides": [
        "¬øCu√°l es la unidad estructural repetitiva de cinco carbonos que forma a todos los isoprenoides?",
        "Distinga entre terpenos y esteroides.",
        "Clasifique los terpenos seg√∫n el n√∫mero de unidades de isopreno y d√© un ejemplo de cada uno.",
        "¬øQu√© son los terpenoides mixtos? Mencione dos ejemplos que sean vitaminas o coenzimas importantes.",
        "Describa la estructura del n√∫cleo esteroideo (cuatro anillos fusionados).",
        "¬øCu√°l es el esterol m√°s importante en los tejidos animales y precursor de otras mol√©culas? Enumere tres tipos de mol√©culas que se sintetizan a partir de √©l.",
        "Nombre las principales clases de hormonas esteroideas y mencione una funci√≥n para cada una.",
        "[APLICACI√ìN] El Œ≤-caroteno es el precursor de la vitamina A (retinol), esencial para la visi√≥n. Investigue c√≥mo se convierte el Œ≤-caroteno en vitamina A.",
        "[APLICACI√ìN] El colesterol es una mol√©cula anfip√°tica y componente de membranas. ¬øC√≥mo se orienta en la bicapa lip√≠dica y cu√°l es su efecto sobre la fluidez?",
        "[APLICACI√ìN] Los √°cidos biliares, como el √°cido c√≥lico, son derivados del colesterol. Compare la estructura del colesterol y el √°cido c√≥lico. ¬øQu√© modificaciones hacen que el √°cido c√≥lico sea un mejor agente emulsionante?",
        "[APLICACI√ìN] Los gluc√≥sidos card√≠acos, como la digitoxina, se usan para tratar la insuficiencia card√≠aca. ¬øQu√© caracter√≠stica estructural los distingue y cu√°l es su mecanismo de acci√≥n?"
    ],
    "3.7 Eicosanoides": [
        "¬øQu√© son los eicosanoides y a partir de qu√© tipo de √°cido graso se derivan principalmente?",
        "Nombre las tres clases principales de eicosanoides.",
        "¬øC√≥mo se liberan los precursores de los eicosanoides de los fosfol√≠pidos de la membrana? ¬øQu√© enzima es responsable?",
        "Compare a los eicosanoides con las hormonas endocrinas en t√©rminos de sitio de producci√≥n y modo de acci√≥n.",
        "La enzima ciclooxigenasa (COX) es clave en la s√≠ntesis de prostaglandinas. ¬øQu√© reacci√≥n cataliza?",
        "¬øQu√© funciones fisiol√≥gicas tienen las prostaglandinas y los tromboxanos? Mencione un rol en la inflamaci√≥n y otro en la hemostasia.",
        "[APLICACI√ìN] La aspirina y otros AINE inhiben la enzima COX. Explique c√≥mo esta inhibici√≥n produce sus efectos antiinflamatorios.",
        "[APLICACI√ìN] Existen dos isoformas: COX-1 y COX-2. ¬øQu√© ventaja terap√©utica ofrecen los inhibidores selectivos de COX-2?",
        "[APLICACI√ìN] El tromboxano A2 (TXA2) promueve agregaci√≥n plaquetaria, mientras que la prostaciclina (PGI2) la inhibe. Explique c√≥mo el balance entre estas dos mol√©culas mantiene la homeostasis vascular.",
        "[APLICACI√ìN] Los corticosteroides son potentes antiinflamatorios que inhiben la fosfolipasa A2. Compare este mecanismo con el de la aspirina. ¬øPor qu√© los corticosteroides tienen un efecto m√°s amplio?"
    ],
    "3.8 Digesti√≥n de l√≠pidos": [
        "Describa los desaf√≠os de la digesti√≥n de l√≠pidos en el ambiente acuoso del tracto gastrointestinal.",
        "¬øCu√°l es el papel de las sales biliares? Explique el proceso de emulsificaci√≥n.",
        "¬øQu√© enzima pancre√°tica hidroliza los triacilgliceroles en el intestino delgado? ¬øQu√© productos se obtienen?",
        "Una vez digeridos, ¬øc√≥mo se absorben los productos de la digesti√≥n en las c√©lulas de la mucosa intestinal?",
        "Dentro de las c√©lulas intestinales, los l√≠pidos se reensamblan en TAGs. ¬øC√≥mo se empaquetan y transportan? Nombre la lipoprote√≠na.",
        "Describa el destino de los quilomicrones en la circulaci√≥n. ¬øQu√© enzima libera los √°cidos grasos en los tejidos perif√©ricos?",
        "[APLICACI√ìN] Un paciente con una obstrucci√≥n del conducto biliar presenta esteatorrea (grasa en las heces). Relacione la falta de bilis en el intestino con este s√≠ntoma.",
        "[APLICACI√ìN] La olestra es un sustituto de la grasa artificial que no puede ser hidrolizada por las lipasas humanas. ¬øPor qu√© no se absorbe y, por lo tanto, no aporta calor√≠as? ¬øQu√© efectos secundarios gastrointestinales podr√≠a causar?",
        "[APLICACI√ìN] ¬øPor qu√© una dieta rica en fibra soluble puede ayudar a reducir los niveles de colesterol en sangre? (Pista: considere el efecto de la fibra sobre la reabsorci√≥n de sales biliares en el ciclo enterohep√°tico).",
        "[APLICACI√ìN] Los pacientes con deficiencia de la enzima lipoprote√≠na lipasa (LPL) o de su cofactor ApoC-II presentan niveles extremadamente altos de triacilgliceroles en sangre despu√©s de una comida (hiperquilomicronemia familiar). Explique el mecanismo molecular de esta condici√≥n."
    ],
    "Caso Cl√≠nico Integradora": [
        "Identifiquen los principales tipos de l√≠pidos que probablemente predominan en la dieta del paciente (p. ej., saturados, insaturados, trans, colesterol).",
        "Expliquen, a nivel molecular, por qu√© una dieta rica en √°cidos grasos saturados y trans tiende a elevar los niveles de colesterol LDL.",
        "Describan la funci√≥n de las lipoprote√≠nas LDL y HDL en el transporte del colesterol. Expliquen por qu√© el LDL se asocia con riesgo cardiovascular (aterosclerosis) y el HDL con protecci√≥n.",
        "Expliquen el mecanismo de acci√≥n de las estatinas a nivel enzim√°tico, identificando la enzima clave que inhiben en la ruta de s√≠ntesis del colesterol.",
        "Se recomienda dieta con pescado graso y aceite de oliva. ¬øQu√© tipo de √°cidos grasos predominan (omega-3, monoinsaturados)?",
        "Expliquen c√≥mo el consumo de √°cidos grasos omega-3 puede ser beneficioso. Relacionen el precursor (√°cido araquid√≥nico vs. EPA) con la producci√≥n de eicosanoides (tromboxanos) y su efecto sobre la agregaci√≥n plaquetaria y la inflamaci√≥n."
    ]
};

/* =========================================
   BASE DE DATOS Y ESTADO
   ========================================= */
const state = {
    points: 0,
    badges: 0,
    answers: {}, // Para ejercicios de texto
    unlockedBadges: [],
    quizzesCompleted: 0
};

// Preguntas del Quiz (50 √≠tems)
const quizzes = [
    {q: "¬øPropiedad principal de los l√≠pidos?", a: ["Solubles en agua", "Insolubles en agua", "Pol√≠meros", "Inorg√°nicos"], c: 1},
    {q: "¬øFunci√≥n principal de los TAGs?", a: ["Estructural", "Se√±alizaci√≥n", "Reserva energ√©tica", "Catal√≠tica"], c: 2},
    {q: "¬øDiferencia de ac. graso saturado?", a: ["Tiene dobles enlaces", "Solo enlaces simples", "Es l√≠quido", "Es corto"], c: 1},
    {q: "¬øEfecto del doble enlace CIS?", a: ["Cadena recta", "Curvatura (kink)", "Aumenta p. fusi√≥n", "Rigidez"], c: 1},
    {q: "¬øPor qu√© las grasas TRANS son malas?", a: ["Son rectas como saturadas", "Son muy curvas", "Se digieren r√°pido", "Son hidrof√≠licas"], c: 0},
    {q: "¬øNomenclatura desde el metilo final?", a: ["Alfa", "Delta", "Omega", "Beta"], c: 2},
    {q: "¬ø√Åcidos grasos esenciales?", a: ["Oleico/Este√°rico", "Linoleico/Linol√©nico", "Palm√≠tico/Araquid√≥nico", "Colesterol"], c: 1},
    {q: "¬øReacci√≥n para hacer jab√≥n?", a: ["Esterificaci√≥n", "Saponificaci√≥n", "Hidrogenaci√≥n", "Oxidaci√≥n"], c: 1},
    {q: "¬øFunci√≥n de las ceras?", a: ["Energ√≠a r√°pida", "Impermeabilizaci√≥n", "Transporte", "Enzimas"], c: 1},
    {q: "¬øCar√°cter de los fosfol√≠pidos?", a: ["Hidrof√≥bico", "Hidrof√≠lico", "Anfip√°tico", "Neutro"], c: 2},
    {q: "¬øEsqueleto de fosfoglic√©ridos?", a: ["Esfingosina", "Glicerol", "Colesterol", "Glucosa"], c: 1},
    {q: "¬øComponente del surfactante pulmonar?", a: ["DPPC", "Cardiolipina", "Cerebr√≥sido", "Colesterol"], c: 0},
    {q: "¬øEsqueleto de esfingol√≠pidos?", a: ["Glicerol", "Esfingosina", "Isopreno", "Serina"], c: 1},
    {q: "¬øL√≠pido abundante en mielina?", a: ["TAG", "Esfingomielina", "Sales biliares", "Vitamina D"], c: 1},
    {q: "¬øQu√© es una ceramida?", a: ["Esfingosina + Ac. Graso", "Glicerol + 2 Ac. Grasos", "Colesterol + Ac. Graso", "Az√∫car + L√≠pido"], c: 0},
    {q: "¬øCausa de Tay-Sachs?", a: ["Falta de Hexosaminidasa A", "Falta de insulina", "Exceso de colesterol", "Dieta pobre"], c: 0},
    {q: "¬øUnidad base de terpenos?", a: ["Amino√°cido", "Isopreno", "Glucosa", "Nucle√≥tido"], c: 1},
    {q: "¬øEstructura del colesterol?", a: ["Cadena lineal", "4 anillos fusionados", "Esfera hueca", "Doble h√©lice"], c: 1},
    {q: "¬øEfecto del colesterol en membrana?", a: ["Aumenta fluidez siempre", "Amortigua la fluidez", "La rompe", "La hace permeable"], c: 1},
    {q: "¬øPrecursor de √°cidos biliares?", a: ["Glucosa", "Colesterol", "Prote√≠nas", "Vitaminas"], c: 1},
    {q: "¬øPrecursor de eicosanoides?", a: ["Ac. Palm√≠tico", "Ac. Araquid√≥nico", "Colesterol", "Esfingosina"], c: 1},
    {q: "¬øFunci√≥n de prostaglandinas?", a: ["Hormonas largas", "Inflamaci√≥n/Dolor local", "Energ√≠a", "Estructura √≥sea"], c: 1},
    {q: "¬øDiana de la Aspirina?", a: ["LPL", "Ciclooxigenasa (COX)", "PLA2", "Insulina"], c: 1},
    {q: "¬øFunci√≥n de sales biliares?", a: ["Hidrolizar", "Emulsificar", "Transportar", "Sintetizar"], c: 1},
    {q: "¬øEnzima digestiva de l√≠pidos?", a: ["Amilasa", "Lipasa Pancre√°tica", "Pepsina", "Tripsina"], c: 1},
    {q: "¬øTransporte de grasa diet√©tica?", a: ["LDL", "Quilomicr√≥n", "HDL", "Alb√∫mina"], c: 1},
    {q: "¬øColesterol 'Malo'?", a: ["HDL", "LDL", "VLDL", "Quilomicr√≥n"], c: 1},
    {q: "¬øColesterol 'Bueno'?", a: ["HDL", "LDL", "VLDL", "IDL"], c: 0},
    {q: "¬øQu√© es aterosclerosis?", a: ["Huesos d√©biles", "Placa en arterias", "Az√∫car en sangre", "Fallo renal"], c: 1},
    {q: "¬øF√°rmaco para bajar colesterol?", a: ["Aspirina", "Estatinas", "Insulina", "Antibi√≥ticos"], c: 1},
    {q: "¬øSe√±al de apoptosis en membrana?", a: ["Fosfatidilcolina fuera", "Fosfatidilserina fuera", "Colesterol dentro", "Prote√≠nas fuera"], c: 1},
    {q: "¬øVitamina derivada de esterol?", a: ["A", "D", "E", "K"], c: 1},
    {q: "¬øL√≠pido de balsas lip√≠dicas?", a: ["TAGs", "Esfingol√≠pidos/Colesterol", "Ac. Grasos Libres", "Vitaminas"], c: 1},
    {q: "¬øQu√© son leucotrienos?", a: ["Mediadores de asma", "Hormonas sexuales", "Vitaminas", "Jabones"], c: 0},
    {q: "¬øEnlace en TAGs?", a: ["Amida", "√âster", "Glucos√≠dico", "Pept√≠dico"], c: 1},
    {q: "¬øEnlace en Ceramida?", a: ["√âster", "Amida", "√âter", "Fosfodi√©ster"], c: 1},
    {q: "¬øLugar de s√≠ntesis de VLDL?", a: ["Intestino", "H√≠gado", "Tejido Adiposo", "Sangre"], c: 1},
    {q: "¬øFunci√≥n de ApoC-II?", a: ["Estructural", "Activar LPL", "Unir receptor", "Antioxidante"], c: 1},
    {q: "¬øDeficiencia en Gaucher?", a: ["Glucocerebrosidasa", "Lipasa", "COX", "Hexosaminidasa"], c: 0},
    {q: "¬øOmega-3 principales?", a: ["EPA/DHA", "Oleico", "Este√°rico", "Araquid√≥nico"], c: 0},
    {q: "¬øD√≥nde ocurre beta-oxidaci√≥n?", a: ["Citoplasma", "Mitocondria", "N√∫cleo", "Golgi"], c: 1},
    {q: "¬øCu√°ntos carbonos tiene el colesterol?", a: ["18", "27", "20", "30"], c: 1},
    {q: "¬øL√≠pidos son pol√≠meros?", a: ["S√≠", "No", "A veces", "Solo TAGs"], c: 1},
    {q: "¬øQu√© es micela?", a: ["Doble capa", "Esfera monocapa", "Cubo", "Red"], c: 1},
    {q: "¬øL√≠pido m√°s abundante en membrana?", a: ["Colesterol", "Fosfoglic√©ridos", "Esfingol√≠pidos", "Ceras"], c: 1},
    {q: "¬øQu√© hace la LPL?", a: ["Sintetiza grasa", "Hidroliza TAGs en sangre", "Absorbe grasa", "Forma bilis"], c: 1},
    {q: "¬øEstructura secundaria de prote√≠nas en membrana?", a: ["L√°mina beta", "H√©lice alfa", "Giro", "Random"], c: 1},
    {q: "¬øMovimiento 'Flip-Flop'?", a: ["R√°pido y com√∫n", "Lento y raro", "Imposible", "Continuo"], c: 1},
    {q: "¬øL√≠pido de reserva en plantas?", a: ["Almid√≥n", "Aceites (TAGs)", "Ceras", "Colesterol"], c: 1},
    {q: "¬øBiof√≠sica estudia...?", a: ["Solo qu√≠mica", "Principios f√≠sicos en biolog√≠a", "Solo anatom√≠a", "Matem√°ticas puras"], c: 1}
];

// Datos Drag & Drop (Expandido)
const dragItems = [
    // √Åcidos Grasos
    {n: "Ac. Oleico", c: "acidos_grasos"}, 
    {n: "Ac. Este√°rico", c: "acidos_grasos"}, 
    {n: "Ac. Araquid√≥nico", c: "acidos_grasos"},
    {n: "Ac. Palm√≠tico", c: "acidos_grasos"},
    {n: "Ac. Linol√©nico (Omega-3)", c: "acidos_grasos"},
    {n: "Ac. But√≠rico (Corto)", c: "acidos_grasos"},
    // Membrana
    {n: "Fosfatidilcolina", c: "membrana"}, 
    {n: "Esfingomielina", c: "membrana"}, 
    {n: "Gangli√≥sido", c: "membrana"},
    {n: "Fosfatidilserina", c: "membrana"},
    {n: "Cardiolipina", c: "membrana"},
    {n: "Plasmal√≥geno", c: "membrana"},
    // Esteroides
    {n: "Colesterol", c: "esteroides"}, 
    {n: "Testosterona", c: "esteroides"}, 
    {n: "Vit. D", c: "esteroides"},
    {n: "Cortisol", c: "esteroides"},
    {n: "Aldosterona", c: "esteroides"},
    {n: "Sales Biliares", c: "esteroides"},
    {n: "Vitamina A (Retinol)", c: "esteroides"},
    // Almacenamiento
    {n: "Grasa Bovina (TAG)", c: "almacenamiento"}, 
    {n: "Cera de Abeja", c: "almacenamiento"}, 
    {n: "Aceite Oliva", c: "almacenamiento"},
    {n: "Tripalmitina", c: "almacenamiento"},
    {n: "Lanolina", c: "almacenamiento"},
    {n: "Cera de Carnauba", c: "almacenamiento"}
];

// Flashcards (Expandido a 65 conceptos)
const flashcards = [
    {f: "Anfip√°tico", b: "Tiene regi√≥n polar y apolar."},
    {f: "Saturado", b: "Sin dobles enlaces. S√≥lido."},
    {f: "Insaturado", b: "Con dobles enlaces. L√≠quido (cis)."},
    {f: "TAG", b: "Reserva energ√≠a. 3 ac. grasos + glicerol."},
    {f: "Fosfol√≠pido", b: "Base de membrana. Cabeza polar + colas."},
    {f: "Esfingosina", b: "Alcohol base de esfingol√≠pidos."},
    {f: "Ceramida", b: "Esfingosina + Ac. Graso."},
    {f: "Colesterol", b: "Regula fluidez. 4 anillos."},
    {f: "Mielina", b: "Aislante el√©ctrico. Rica en l√≠pidos."},
    {f: "Isopreno", b: "Unidad 5C de terpenos."},
    {f: "Prostaglandina", b: "Inflamaci√≥n y dolor."},
    {f: "COX", b: "Enzima que crea prostaglandinas."},
    {f: "Aspirina", b: "Inhibe COX irreversiblemente."},
    {f: "Quilomicr√≥n", b: "Transporta grasa dieta."},
    {f: "VLDL", b: "Transporta grasa h√≠gado->tejidos."},
    {f: "LDL", b: "Colesterol a tejidos (Malo)."},
    {f: "HDL", b: "Colesterol a h√≠gado (Bueno)."},
    {f: "Aterosclerosis", b: "Placa en arterias."},
    {f: "Estatinas", b: "Inhiben s√≠ntesis colesterol."},
    {f: "Saponificaci√≥n", b: "Grasa + Base = Jab√≥n."},
    {f: "Ceras", b: "Impermeabilizantes biol√≥gicos."},
    {f: "Omega-3", b: "Cardioprotector. Pescado."},
    {f: "Omega-6", b: "Pro-inflamatorio en exceso."},
    {f: "Trans", b: "Grasa industrial nociva."},
    {f: "Micela", b: "Esfera lip√≠dica en agua (monocapa)."},
    {f: "Liposoma", b: "Ves√≠cula bicapa artificial (f√°rmacos)."},
    {f: "Flip-Flop", b: "Movimiento raro entre capas."},
    {f: "Difusi√≥n Lateral", b: "Movimiento com√∫n en capa."},
    {f: "Balsa Lip√≠dica", b: "Zona r√≠gida membrana (Colesterol/Esfingol√≠pidos)."},
    {f: "Glucol√≠pido", b: "L√≠pido + Az√∫car (reconocimiento)."},
    {f: "Surfactante", b: "Evita colapso pulmonar."},
    {f: "DPPC", b: "Fosfol√≠pido del surfactante."},
    {f: "Tay-Sachs", b: "Acumulaci√≥n gangli√≥sidos (Hexosaminidasa A)."},
    {f: "Gaucher", b: "Acumulaci√≥n glucocerebr√≥sidos."},
    {f: "Niemann-Pick", b: "Acumulaci√≥n esfingomielina."},
    {f: "Sales Biliares", b: "Emulsionan grasas."},
    {f: "Lipasa", b: "Digiere grasas (P√°ncreas)."},
    {f: "LPL", b: "Limpia grasa de sangre (Capilares)."},
    {f: "ApoB-100", b: "Prote√≠na estructural del LDL."},
    {f: "ApoA-1", b: "Prote√≠na estructural del HDL."},
    {f: "ApoC-II", b: "Cofactor activador de LPL."},
    {f: "ApoE", b: "Ligando para receptores hep√°ticos."},
    {f: "Eicosanoide", b: "Se√±alizador local 20C."},
    {f: "Tromboxano A2", b: "Agregaci√≥n plaquetaria (Co√°gulos)."},
    {f: "Leucotrienos", b: "Broncoconstricci√≥n (Asma)."},
    {f: "Vitamina A", b: "Retinol. Visi√≥n."},
    {f: "Vitamina D", b: "Calcio y Hueso. (Luz solar)."},
    {f: "Vitamina E", b: "Antioxidante de membrana."},
    {f: "Vitamina K", b: "Coagulaci√≥n sangu√≠nea."},
    {f: "Beta-oxidaci√≥n", b: "Degradaci√≥n de grasas en mitocondria."},
    {f: "Cuerpos Cet√≥nicos", b: "Combustible alternativo (Cerebro en ayuno)."},
    {f: "Hidrogenaci√≥n", b: "Proceso industrial Aceite -> Grasa S√≥lida."},
    {f: "Rancidez", b: "Oxidaci√≥n de grasas (Mal olor)."},
    {f: "LCAT", b: "Esterifica colesterol en HDL."},
    {f: "ACAT", b: "Esterifica colesterol en c√©lulas."},
    {f: "Quilomicr√≥n Remanente", b: "Producto tras acci√≥n de LPL."},
    {f: "Receptor LDL", b: "Capta colesterol en c√©lulas."},
    {f: "Dislipidemia", b: "Niveles anormales de l√≠pidos."},
    {f: "√Åcido Linoleico", b: "Esencial Omega-6."},
    {f: "√Åcido Linol√©nico", b: "Esencial Omega-3."},
    {f: "√Åcido Araquid√≥nico", b: "Precursor de eicosanoides (20C)."},
    {f: "Esteroides", b: "Derivados del n√∫cleo esteroideo (4 anillos)."},
    {f: "Terpenos", b: "Pol√≠meros de isopreno (Aromas, Vitaminas)."},
    {f: "Fosfatidiletanolamina", b: "Fosfol√≠pido com√∫n (Cefalina)."},
    {f: "Gangli√≥sido", b: "Esfingol√≠pido complejo (Cerebro)."}
];

/* =========================================
   SISTEMA DE GUARDADO
   ========================================= */
const saveSystem = {
    key: 'uach_bio_obj3_full',
    init: function() {
        if(localStorage.getItem(this.key)) {
            const data = JSON.parse(localStorage.getItem(this.key));
            state.points = data.points || 0;
            state.badges = data.badges || 0;
            state.unlockedBadges = data.unlockedBadges || [];
            state.answers = data.answers || {};
            // Restaurar estado visual
            state.unlockedBadges.forEach(id => document.getElementById(id).classList.add('unlocked'));
            updateStats();
        }
    },
    save: function(silent = false) {
        localStorage.setItem(this.key, JSON.stringify(state));
        const date = new Date().toLocaleTimeString();
        document.getElementById('menu-last-save').innerText = 'Guardado: ' + date;
        if(!silent) showToast();
    },
    forceSave: function() { this.save(false); toggleSaveMenu(); },
    clearProgress: function() {
        if(confirm("¬øSeguro que quieres borrar todo tu progreso?")) {
            localStorage.removeItem(this.key);
            location.reload();
        }
    },
    downloadBackup: function() {
        const blob = new Blob([JSON.stringify(state)], {type:'application/json'});
        const url = URL.createObjectURL(blob);
        const a = document.createElement('a'); a.href=url; a.download='biofisica_backup.json';
        a.click();
    },
    restoreBackup: function(input) {
        const file = input.files[0];
        const reader = new FileReader();
        reader.onload = function(e) {
            try {
                const data = JSON.parse(e.target.result);
                localStorage.setItem(saveSystem.key, JSON.stringify(data));
                location.reload();
            } catch(err) { alert("Archivo inv√°lido"); }
        };
        reader.readAsText(file);
    }
};

/* =========================================
   L√ìGICA DE INTERFAZ
   ========================================= */
function init() {
    saveSystem.init();
    renderQuizzes();
    renderDragDrop();
    renderExercises();
    renderFlashcards();
    lipidSim.selectLipid('saturado'); 
    lpSim.update('chylomicron'); // Inicializar lipoprote√≠na por defecto
    
    setTimeout(() => {
        document.getElementById('loading').classList.add('hidden');
        document.getElementById('app').classList.remove('hidden');
    }, 800);
}

function showTab(id) {
    document.querySelectorAll('.tab-content').forEach(d => d.classList.add('hidden'));
    document.getElementById('tab-'+id).classList.remove('hidden');
    document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
    document.querySelector(`.tab[onclick="showTab('${id}')"]`).classList.add('active');
}

function showToast() {
    const t = document.getElementById('save-notification');
    t.style.opacity = '1';
    setTimeout(() => t.style.opacity = '0', 2000);
}

function toggleSaveMenu() {
    document.getElementById('save-menu').classList.toggle('show');
}

function updateStats() {
    document.getElementById('stat-points').innerText = state.points;
    document.getElementById('stat-badges').innerText = state.badges + '/10';
    document.getElementById('progress-fill').style.width = Math.min(100, (state.points/1000)*100) + '%';
    
    // Check logros
    if(state.points > 0) unlock('ach-1');
    if(state.points >= 100) unlock('ach-2');
    if(state.points >= 500) unlock('ach-6');
    if(state.points >= 1000) unlock('ach-10');
}

function unlock(id) {
    if(!state.unlockedBadges.includes(id)) {
        state.unlockedBadges.push(id);
        state.badges++;
        document.getElementById(id).classList.add('unlocked');
        // Modal
        const el = document.getElementById(id);
        const title = {
            'ach-1': 'Iniciado', 'ach-2': 'Estudioso', 'ach-3': 'Perfecto',
            'ach-4': 'Clasificador', 'ach-5': 'Biof√≠sico', 'ach-6': 'Medio Camino',
            'ach-7': 'Analista', 'ach-8': 'Experto', 'ach-9': 'Transportista', 'ach-10': 'Maestro'
        };
        document.getElementById('modal-title').innerText = title[id];
        document.getElementById('modal-desc').innerText = "¬°Has desbloqueado una nueva medalla!";
        document.getElementById('achievement-modal').classList.add('show');
        saveSystem.save(true);
    }
}

function addPoints(n) {
    state.points += n;
    updateStats();
    saveSystem.save(true);
}

/* =========================================
   SIMULADOR DE L√çPIDOS (MEMBRANA)
   ========================================= */
const lipidSim = {
    data: {
        saturado: { color: '#15803d', fluid: 10, msg: 'R√≠gido, Empaque Denso', class: 'fluid-low' },
        cis: { color: '#2563eb', fluid: 90, msg: 'Fluido, Empaque Laxo (Codos)', class: 'fluid-high' },
        trans: { color: '#dc2626', fluid: 20, msg: 'R√≠gido Artificial (Peligroso)', class: 'fluid-low' },
        colesterol: { color: '#7c3aed', fluid: 50, msg: 'Amortiguador de Fluidez', class: 'fluid-med' },
        mixto: { color: '#4b5563', fluid: 65, msg: 'Equilibrio Fisiol√≥gico', class: 'fluid-med' }
    },
    selectLipid: function(type) {
        document.querySelectorAll('.lipid-btn').forEach(b => b.classList.remove('active'));
        document.getElementById('btn-'+type).classList.add('active');
        
        const d = this.data[type];
        
        // Update SVG
        const svg = document.getElementById('structure-svg');
        svg.innerHTML = '';
        this.drawStructure(svg, type, d.color);
        
        // Update Meter
        document.getElementById('fluidity-meter').style.width = d.fluid + '%';
        document.getElementById('fluidity-val').innerText = d.msg;
        document.getElementById('lipid-info').innerHTML = `<strong>Caracter√≠sticas:</strong> ${d.msg}`;
        
        // Animate Bilayer
        this.renderBilayer(type, d.class);
        
        if(type === 'mixto') unlock('ach-5');
    },
    drawStructure: function(svg, type, color) {
        // Cabeza
        const head = `<circle cx="50" cy="50" r="15" fill="#fbbf24" stroke="${color}" stroke-width="2"/>`;
        let tails = '';
        if(type === 'saturado') {
            tails = `<path d="M40 65 L40 200 M60 65 L60 200" stroke="${color}" stroke-width="8" stroke-linecap="round"/>`;
        } else if(type === 'cis') {
            tails = `<path d="M40 65 L40 200 M60 65 L60 120 L90 150 L100 200" stroke="${color}" stroke-width="8" fill="none" stroke-linecap="round"/>`;
        } else if(type === 'trans') {
            tails = `<path d="M40 65 L40 200 M60 65 L60 200" stroke="${color}" stroke-width="8" stroke-dasharray="10,5"/>`; // Dashed for fake straight
        } else if(type === 'colesterol') {
            tails = `<path d="M40 65 L80 65 L80 100 L40 100 Z M40 100 L80 100 L80 135 L40 135 Z" fill="none" stroke="${color}" stroke-width="3"/> <line x1="60" y1="135" x2="60" y2="200" stroke="${color}" stroke-width="4"/>`;
        } else {
             tails = `<text x="20" y="150" fill="#666">Mezcla compleja</text>`;
        }
        svg.innerHTML = head + tails;
    },
    renderBilayer: function(type, animClass) {
        const con = document.getElementById('bilayer');
        con.innerHTML = '';
        const row1 = document.createElement('div'); row1.className = 'layer upper';
        const row2 = document.createElement('div'); row2.className = 'layer';
        
        for(let i=0; i<10; i++) {
            row1.appendChild(this.createMol(type, animClass));
            row2.appendChild(this.createMol(type, animClass));
        }
        con.appendChild(row1); con.appendChild(row2);
    },
    createMol: function(type, animClass) {
        const m = document.createElement('div');
        m.className = `lipid-molecule ${animClass}`;
        // Simplificado para visualizaci√≥n
        m.innerHTML = `<div class="head"></div><div class="tail-container"><div class="tail ${type}"></div><div class="tail ${type}"></div></div>`;
        return m;
    }
};

/* =========================================
   SIMULADOR DE LIPOPROTE√çNAS (NUEVO)
   ========================================= */
const lpSim = {
    data: {
        chylomicron: {
            name: "Quilomicr√≥n",
            size: "240px",
            color: "radial-gradient(circle, #fef08a 80%, #ca8a04 100%)",
            desc: "<strong>Origen:</strong> Intestino.<br><strong>Funci√≥n:</strong> Transporte de l√≠pidos de la dieta.",
            stats: {
                tg: "85-95%", prot: "1-2%", chol_esters: "3-5%", chol_free: "1-3%", phos: "3-6%",
                apos: ["A-I", "A-II", "B-48", "C", "E"]
            }
        },
        vldl: {
            name: "VLDL",
            size: "160px",
            color: "radial-gradient(circle, #fde047 60%, #a16207 100%)",
            desc: "<strong>Origen:</strong> H√≠gado.<br><strong>Funci√≥n:</strong> Transporte de TAGs end√≥genos.",
            stats: {
                tg: "50-65%", prot: "10%", chol_esters: "12%", chol_free: "7%", phos: "15-20%",
                apos: ["B-100", "C", "E"]
            }
        },
        ldl: {
            name: "LDL (Colesterol Malo)",
            size: "100px",
            color: "radial-gradient(circle, #f87171 20%, #b91c1c 100%)",
            desc: "<strong>Origen:</strong> IDL/VLDL.<br><strong>Funci√≥n:</strong> Transporte de colesterol a tejidos.",
            stats: {
                tg: "6%", prot: "25%", chol_esters: "42%", chol_free: "8%", phos: "22%",
                apos: ["B-100"]
            }
        },
        hdl: {
            name: "HDL (Colesterol Bueno)",
            size: "60px",
            color: "radial-gradient(circle, #4ade80 10%, #166534 100%)",
            desc: "<strong>Origen:</strong> H√≠gado/Intestino.<br><strong>Funci√≥n:</strong> Transporte reverso de colesterol.",
            stats: {
                tg: "3-5%", prot: "40-55%", chol_esters: "15-20%", chol_free: "3-4%", phos: "25-30%",
                apos: ["A-I", "A-II", "C", "E"]
            }
        }
    },
    update: function(type) {
        const lp = this.data[type];
        const core = document.getElementById('lp-core');
        
        // Cambiar tama√±o y color
        core.style.width = lp.size;
        core.style.height = lp.size;
        core.style.background = lp.color;
        
        // Actualizar Apoprote√≠nas Visuales
        core.innerHTML = ''; // Limpiar anteriores
        
        // Colores para Apos
        const apoColors = {
            "B-48": "#1d4ed8", "B-100": "#1e40af", // Azules oscuros
            "A-I": "#be123c", "A-II": "#e11d48",   // Rojos/Rosas
            "C": "#047857", "E": "#7c3aed"         // Verde, Morado
        };

        const apos = lp.stats.apos;
        const total = apos.length;
        
        apos.forEach((apo, index) => {
            const el = document.createElement('div');
            el.className = 'apoprotein';
            el.innerText = apo;
            
            // Posicionar alrededor del c√≠rculo
            const angle = (index / total) * 2 * Math.PI; // Distribuci√≥n radial
            const radius = 55; // % desde el centro (borde es 50%, un poco afuera)
            const x = 50 + radius * Math.cos(angle); 
            const y = 50 + radius * Math.sin(angle);
            
            el.style.left = x + '%';
            el.style.top = y + '%';
            el.style.transform = 'translate(-50%, -50%)'; // Centrar elemento
            el.style.backgroundColor = apoColors[apo] || '#ef4444';
            
            // Estilo espec√≠fico si es integral grande (B-100/B-48)
            if(apo.includes('B-')) {
                el.style.borderRadius = '4px'; // M√°s rectangular
                el.style.padding = '6px 10px';
                el.style.zIndex = '10';
            }
            
            core.appendChild(el);
        });

        // Actualizar textos b√°sicos
        document.getElementById('lp-name').innerText = lp.name;
        
        // Generar HTML de Estad√≠sticas
        const statsHtml = `
            <div style="margin-bottom:1rem; border-bottom:1px solid #e5e7eb; padding-bottom:1rem;">
                <div style="font-size:0.9rem; color:#4b5563; margin-bottom:0.8rem">${lp.desc}</div>
                
                <div style="display:grid; grid-template-columns: repeat(auto-fit, minmax(80px, 1fr)); gap:0.5rem; text-align:center;">
                    <div style="background:white; padding:0.5rem; border-radius:0.5rem; border:1px solid #e5e7eb; box-shadow:0 1px 2px rgba(0,0,0,0.05)">
                        <div style="font-size:0.7rem; color:#6b7280; text-transform:uppercase;">Triglic√©ridos</div>
                        <div style="font-weight:bold; color:#ca8a04; font-size:1.1rem">${lp.stats.tg}</div>
                    </div>
                    <div style="background:white; padding:0.5rem; border-radius:0.5rem; border:1px solid #e5e7eb; box-shadow:0 1px 2px rgba(0,0,0,0.05)">
                        <div style="font-size:0.7rem; color:#6b7280; text-transform:uppercase;">Prote√≠nas</div>
                        <div style="font-weight:bold; color:#ef4444; font-size:1.1rem">${lp.stats.prot}</div>
                    </div>
                    <div style="background:white; padding:0.5rem; border-radius:0.5rem; border:1px solid #e5e7eb; box-shadow:0 1px 2px rgba(0,0,0,0.05)">
                        <div style="font-size:0.7rem; color:#6b7280; text-transform:uppercase;">Col. Ester</div>
                        <div style="font-weight:bold; color:#f59e0b; font-size:1.1rem">${lp.stats.chol_esters}</div>
                    </div>
                     <div style="background:white; padding:0.5rem; border-radius:0.5rem; border:1px solid #e5e7eb; box-shadow:0 1px 2px rgba(0,0,0,0.05)">
                        <div style="font-size:0.7rem; color:#6b7280; text-transform:uppercase;">Fosfol√≠pidos</div>
                        <div style="font-weight:bold; color:#10b981; font-size:1.1rem">${lp.stats.phos}</div>
                    </div>
                </div>
            </div>
            
            <div style="background:#eff6ff; padding:0.75rem; border-radius:0.5rem; border:1px solid #bfdbfe;">
                <div style="font-size:0.75rem; font-weight:bold; color:#1e40af; text-transform:uppercase; margin-bottom:0.25rem">Apolipoprote√≠nas Clave</div>
                <div style="display:flex; gap:0.5rem; flex-wrap:wrap;">
                    ${lp.stats.apos.map(apo => `<span style="background:white; padding:2px 8px; border-radius:12px; font-size:0.8rem; color:#1e3a8a; border:1px solid #93c5fd; font-weight:600">${apo}</span>`).join('')}
                </div>
            </div>
        `;

        document.getElementById('lp-desc').innerHTML = statsHtml;
        
        // Actualizar botones UI
        document.querySelectorAll('[id^="btn-lp-"]').forEach(btn => btn.classList.remove('active'));
        document.getElementById('btn-lp-' + (type === 'chylomicron' ? 'chy' : type)).classList.add('active');
        
        unlock('ach-9'); // Desbloquea logro Transportista
    }
};

/* =========================================
   QUIZ LOGIC
   ========================================= */
function renderQuizzes() {
    const con = document.getElementById('quiz-container');
    let h = '';
    quizzes.forEach((q, i) => {
        h += `<div class="quiz-question" id="q-${i}">
            <div class="quiz-q">${i+1}. ${q.q}</div>
            ${q.a.map((opt, j) => `<div class="quiz-option" onclick="checkQuiz(${i}, ${j})">${opt}</div>`).join('')}
            <div id="fb-${i}" class="quiz-feedback hidden"></div>
        </div>`;
    });
    con.innerHTML = h;
}

function checkQuiz(i, j) {
    const q = quizzes[i];
    const opts = document.querySelectorAll(`#q-${i} .quiz-option`);
    const fb = document.getElementById(`fb-${i}`);
    
    opts.forEach(o => o.style.pointerEvents = 'none');
    
    if(j === q.c) {
        opts[j].classList.add('correct');
        fb.innerHTML = "¬°Correcto! +10 puntos";
        fb.className = "quiz-feedback correct";
        addPoints(10);
        state.quizzesCompleted++;
    } else {
        opts[j].classList.add('incorrect');
        opts[q.c].classList.add('correct');
        fb.innerHTML = "Incorrecto.";
        fb.className = "quiz-feedback incorrect";
    }
    
    if(state.quizzesCompleted === quizzes.length) unlock('ach-10');
    if(state.quizzesCompleted === 1 && j===q.c) unlock('ach-3'); // Simulado para demo
}

/* =========================================
   DRAG & DROP
   ========================================= */
function renderDragDrop() {
    const con = document.getElementById('draggables-container');
    con.innerHTML = dragItems.map((item, i) => 
        `<div class="draggable" draggable="true" id="d-${i}" data-cat="${item.c}">${item.n}</div>`
    ).join('');
    
    // Listeners
    document.querySelectorAll('.draggable').forEach(d => {
        d.addEventListener('dragstart', e => e.dataTransfer.setData('text', e.target.id));
    });
    
    document.querySelectorAll('.drop-zone').forEach(z => {
        z.addEventListener('dragover', e => { e.preventDefault(); z.classList.add('over'); });
        z.addEventListener('dragleave', () => z.classList.remove('over'));
        z.addEventListener('drop', e => {
            e.preventDefault();
            z.classList.remove('over');
            const id = e.dataTransfer.getData('text');
            const el = document.getElementById(id);
            if(el) z.querySelector('.drop-items').appendChild(el);
        });
    });
}

function checkDragDrop() {
    let ok = 0;
    document.querySelectorAll('.draggable').forEach(d => {
        const zone = d.parentElement.parentElement;
        if(zone.classList.contains('drop-zone')) {
            if(zone.dataset.category === d.dataset.cat) {
                d.classList.add('placed');
                d.draggable = false;
                ok++;
            } else {
                d.style.borderColor = 'red';
            }
        }
    });
    addPoints(ok * 5);
    alert(`Has clasificado correctamente ${ok} elementos.`);
    if(ok >= 5) unlock('ach-4');
}

/* =========================================
   EJERCICIOS Y FLASHCARDS
   ========================================= */
function renderExercises() {
    const container = document.getElementById('preguntas-render-zone');
    let html = '';
    let counter = 1;

    for (const sectionTitle in preguntasData) {
        html += `<div class="card"><div class="card-header">${sectionTitle}</div><div class="quiz-container">`;
        
        preguntasData[sectionTitle].forEach((q, index) => {
            const qId = `${sectionTitle.replace(/\s/g, '')}-${index}`;
            const val = state.answers[qId] || '';
            const isCompleted = val.length > 10 ? 'completed' : '';
            
            html += `
                <div class="question-item ${isCompleted}" id="q-box-${qId}">
                    <p><strong>${counter}. ${q}</strong></p>
                    <textarea oninput="saveEx('${qId}', this.value)" placeholder="Escribe tu respuesta aqu√≠...">${val}</textarea>
                </div>
            `;
            counter++;
        });
        html += `</div></div>`;
    }
    
    container.innerHTML = html;
}

function saveEx(id, val) {
    state.answers[id] = val;
    saveSystem.save(true);
    
    const box = document.getElementById(`q-box-${id}`);
    if (val.length > 20) {
        box.classList.add('completed');
        unlock('ach-7'); // Logro Analista
    } else {
        box.classList.remove('completed');
    }
}

function renderFlashcards() {
    const con = document.getElementById('flashcard-container');
    con.innerHTML = flashcards.map(f => `
        <div class="flashcard" onclick="this.classList.toggle('flipped')">
            <div class="flashcard-inner">
                <div class="flashcard-front">
                    <div style="font-size:2rem">üß¨</div>
                    <h3>${f.f}</h3>
                    <small>Click para voltear</small>
                </div>
                <div class="flashcard-back">
                    <p>${f.b}</p>
                </div>
            </div>
        </div>
    `).join('');
}

/* =========================================
   CALCULADORAS
   ========================================= */
function calcIodine() {
    const val = document.getElementById('calc-iodine-select').value;
    const res = document.getElementById('iodine-result');
    if(!val) return;
    const n = parseInt(val);
    let txt = "";
    if(n === 0) txt = "Saturado (0 dobles enlaces).";
    else if(n < 100) txt = "Monoinsaturado.";
    else txt = "Poliinsaturado.";
    res.innerText = `√çndice: ${n} - ${txt}`;
}

function calcMP() {
    const c = parseInt(document.getElementById('mp-c').value);
    const db = parseInt(document.getElementById('mp-db').value);
    const cfg = document.getElementById('mp-cfg').value;
    
    // Algoritmo simulado
    let temp = (c * 3) + 10; // Base por carbonos
    if(cfg === 'cis') temp -= (db * 20); // Cis baja mucho
    else temp -= (db * 5); // Trans baja poco
    
    document.getElementById('mp-val').innerText = temp + "¬∞C";
    const state = temp > 25 ? "S√≥lido üß±" : "L√≠quido üíß";
    document.getElementById('mp-state').innerText = state;
    document.getElementById('mp-state').style.color = temp > 25 ? "#b91c1c" : "#0284c7";
}

// Iniciar app
document.addEventListener('DOMContentLoaded', init);
</script>
</body>
</html>
