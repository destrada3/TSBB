<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Biof√≠sica UACH - Objeto 3: L√≠pidos y Membranas (Master Version)</title>
<script src="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/js/all.min.js"></script>
<style>
    /* =========================================
       ESTILOS GENERALES
       ========================================= */
    :root {
        --color-primary: #7f1d1d;
        --color-primary-dark: #991b1b;
        --color-bg: #f3f4f6;
        --color-sat: #15803d;
        --color-cis: #2563eb;
        --color-trans: #dc2626;
        --color-chol: #7c3aed;
    }

    * {margin:0;padding:0;box-sizing:border-box}
    body {font-family:system-ui,-apple-system,sans-serif;background:var(--color-bg);color:#111827;line-height:1.6}
    .container {max-width:1200px;margin:0 auto;padding:0 1rem}
    .hidden {display:none !important}

    /* Loading Overlay */
    .loading {position:fixed;inset:0;background:#f3f4f6;display:flex;align-items:center;justify-content:center;z-index:100;flex-direction:column;gap:1rem}
    .spinner {width:40px;height:40px;border:4px solid var(--color-primary);border-top-color:transparent;border-radius:50%;animation:spin 1s linear infinite}
    @keyframes spin {to{transform:rotate(360deg)}}

    /* Navbar */
    .navbar {position:fixed;top:0;left:0;right:0;background:white;border-bottom:1px solid #e5e7eb;z-index:50;box-shadow:0 1px 3px rgba(0,0,0,0.1)}
    .navbar-content {display:flex;justify-content:space-between;align-items:center;height:4rem;padding:0 1rem}
    .brand {display:flex;align-items:center;gap:0.75rem}
    .brand-icon {width:2.5rem;height:2.5rem;background:var(--color-primary);color:white;border-radius:0.5rem;display:flex;align-items:center;justify-content:center;font-size:1.25rem}
    .brand-text h1 {font-size:0.875rem;font-weight:700;color:#111827}
    .brand-text p {font-size:0.75rem;color:#6b7280}

    /* Stats Header */
    .stats {display:flex;gap:1rem;align-items:center}
    .stat-item {text-align:center;padding:0.5rem;background:#f9fafb;border-radius:0.5rem;min-width:4rem}
    .stat-value {font-size:1.25rem;font-weight:700;color:var(--color-primary)}
    .stat-label {font-size:0.625rem;color:#6b7280;text-transform:uppercase}
    .progress {width:8rem}
    .progress-bar {height:0.5rem;background:#e5e7eb;border-radius:9999px;overflow:hidden;margin-top:0.25rem}
    .progress-fill {height:100%;background:var(--color-primary);transition:width 0.3s;width:0%}

    /* Main Content */
    main {padding-top:5rem;padding-bottom:5rem}
    .hero {background:linear-gradient(135deg,var(--color-primary),#991b1b);color:white;padding:2rem;border-radius:1rem;margin-bottom:2rem;position:relative;overflow:hidden}
    .hero::before {content:'';position:absolute;top:-50%;right:-10%;width:300px;height:300px;background:rgba(255,255,255,0.1);border-radius:50%;z-index:0}
    .hero-content {position:relative;z-index:1}
    .hero h2 {font-size:1.875rem;font-weight:700;margin-bottom:0.5rem}
    .btn {display:inline-flex;align-items:center;gap:0.5rem;padding:0.625rem 1.25rem;border-radius:0.5rem;font-weight:600;cursor:pointer;border:none;font-size:0.875rem;transition:all 0.2s}
    .btn-white {background:white;color:var(--color-primary)}
    .btn-white:hover {background:#f9fafb;transform:translateY(-1px)}
    .btn-outline {background:rgba(255,255,255,0.1);color:white;border:1px solid rgba(255,255,255,0.3)}
    .btn-outline:hover {background:rgba(255,255,255,0.2)}

    /* Tabs */
    .tabs {display:flex;gap:0.5rem;margin-bottom:2rem;background:white;padding:0.5rem;border-radius:0.75rem;box-shadow:0 1px 3px rgba(0,0,0,0.1);overflow-x:auto}
    .tab {padding:0.75rem 1rem;border-radius:0.5rem;cursor:pointer;white-space:nowrap;font-size:0.9rem;font-weight:600;color:#6b7280;transition:all 0.2s}
    .tab:hover {background:#f3f4f6;color:var(--color-primary)}
    .tab.active {background:var(--color-primary);color:white}

    /* Cards */
    .card {background:white;border-radius:0.75rem;box-shadow:0 1px 3px rgba(0,0,0,0.1);border:1px solid #e5e7eb;margin-bottom:1.5rem;overflow:hidden}
    .card-header {padding:1rem 1.5rem;border-bottom:1px solid #e5e7eb;background:#f9fafb;font-weight:700;display:flex;align-items:center;gap:0.5rem}

    /* Simulator Styles */
    .simulator-grid {display: grid; grid-template-columns: 1fr 1fr; gap: 1.5rem; padding: 1.5rem;}
    .lipid-selector {display: grid; grid-template-columns: repeat(auto-fit, minmax(100px, 1fr)); gap: 0.5rem; padding: 1rem;}
    .lipid-btn {padding: 0.75rem; border: 2px solid #e5e7eb; border-radius: 0.75rem; background: white; cursor: pointer; transition: all 0.2s; text-align: center; font-size: 0.75rem; font-weight: 500; display: flex; flex-direction: column; align-items: center;}
    .lipid-btn.active {border-color: var(--color-primary); background: #fef2f2;}
    .structure-viewer {min-height: 250px; background: #fafafa; border-radius: 0.75rem; padding: 1rem; border: 2px solid #e5e7eb; display: flex; justify-content: center; align-items: center;}
    .membrane-simulation {height: 350px; background: linear-gradient(to bottom, #dbeafe, white, #dbeafe); border-radius: 0.75rem; padding: 1rem; position: relative; overflow: hidden; border: 2px solid #e5e7eb;}
    .bilayer {height: 100%; display: flex; flex-direction: column; justify-content: center; align-items: center; gap: 4px;}
    .layer {display: flex; justify-content: center; align-items: flex-end; gap: 2px; height: 100px; width: 100%;}
    .layer.upper {transform: scaleY(-1);}
    
    /* Molecules */
    .lipid-molecule {display: flex; flex-direction: column; align-items: center; width: 22px; position: relative; transform-origin: top center;}
    .head {width: 16px; height: 16px; border-radius: 50%; margin-bottom: -2px; z-index: 2; background: radial-gradient(circle, #fbbf24, #d97706);}
    .tail-container {width: 100%; display: flex; justify-content: center; gap: 2px;}
    .tail {width: 4px; height: 60px; border-radius: 3px; position: relative; opacity: 0.9;}
    .tail.straight {background: linear-gradient(to bottom, var(--color-sat), #14532d);}
    .tail.cis {background: linear-gradient(135deg, var(--color-cis), #1e3a8a); border-radius: 0 0 10px 10px; transform: rotate(-15deg) translateX(-5px); height: 50px;}
    .tail.trans {background: linear-gradient(to bottom, var(--color-trans), #7f1d1d);}
    .tail.cholesterol {height: 35px; width: 6px; background: var(--color-chol); margin-top: 10px;}

    /* Animations */
    @keyframes sway { 0% { transform: rotate(-5deg); } 50% { transform: rotate(5deg); } 100% { transform: rotate(-5deg); } }
    @keyframes vibrate { 0% { transform: translateX(-1px); } 50% { transform: translateX(1px); } 100% { transform: translateX(-1px); } }
    .fluid-high .tail-container { animation: sway 2s infinite ease-in-out; }
    .fluid-low .tail-container { animation: vibrate 0.2s infinite linear; }
    .fluid-med .tail-container { animation: sway 4s infinite ease-in-out; }

    /* Comparison & Info */
    .comparison-grid {display: grid; grid-template-columns: repeat(3, 1fr); gap: 1rem; padding: 1.5rem;}
    .comparison-card {padding: 0.75rem; border: 2px solid #e5e7eb; border-radius: 0.75rem; text-align: center; font-size: 0.8rem;}
    .info-panel {background: #eff6ff; border-left: 4px solid #3b82f6; padding: 1rem; border-radius: 0.5rem; margin-top: 1rem;}
    .info-panel.warning {background: #fffbeb; border-left-color: #f59e0b;}

    /* Nervous System Panel Styles */
    .nervous-system-panel {background: linear-gradient(135deg, #fef3c7, #fef9c3); border: 2px solid #fbbf24; border-radius: 1rem; padding: 1.5rem; margin: 1.5rem;}
    .effects-grid {display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 1rem; margin-top: 1rem;}
    .effect-card {background: white; padding: 1rem; border-radius: 0.5rem; border-left: 4px solid #f59e0b; box-shadow: 0 2px 4px rgba(0,0,0,0.05);}
    .effect-card.severe {border-left-color: #ef4444;}
    .effect-card h4 {margin-bottom: 0.5rem; color: #1f2937;}
    .effect-card p {font-size: 0.85rem; color: #4b5563;}

    /* Quizzes & Questions */
    .quiz-container {padding:1.5rem}
    .quiz-question {margin-bottom:2rem; background: #fff; padding: 1.5rem; border-radius: 0.5rem; box-shadow: 0 2px 4px rgba(0,0,0,0.05); border: 1px solid #f3f4f6;}
    .quiz-q {font-weight:700;margin-bottom:1rem;font-size:1.1rem; color: #1f2937;}
    .quiz-option {padding:1rem;border:2px solid #e5e7eb;border-radius:0.5rem;cursor:pointer;transition:all 0.2s;background:white; margin-bottom: 0.5rem;}
    .quiz-option:hover {border-color:var(--color-primary);background:#fef2f2}
    .quiz-option.selected {border-color:var(--color-primary);background:#fee2e2}
    .quiz-option.correct {border-color:#22c55e;background:#f0fdf4}
    .quiz-option.incorrect {border-color:#ef4444;background:#fef2f2}
    .quiz-feedback {margin-top:1rem;padding:1rem;border-radius:0.5rem;font-size:0.9rem}
    .quiz-feedback.correct {background:#f0fdf4;border:1px solid #86efac;color:#166534}
    .quiz-feedback.incorrect {background:#fef2f2;border:1px solid #fca5a5;color:#991b1b}

    /* Drag & Drop */
    .drag-drop-zone {padding:1.5rem}
    .drop-zones {display:grid;grid-template-columns:repeat(auto-fit,minmax(200px,1fr));gap:1rem;margin-bottom:1.5rem}
    .drop-zone {min-height:250px;padding:1rem;border:2px dashed #d1d5db;border-radius:0.75rem;background:#fafafa; display: flex; flex-direction: column;}
    .drop-zone-title {font-weight:700;margin-bottom:0.75rem;color:#374151;text-align:center;padding-bottom:0.5rem;border-bottom:2px solid #e5e7eb}
    .drop-zone.over {border-color:var(--color-primary);background:#fef2f2}
    .draggables {display:flex;flex-wrap:wrap;gap:0.75rem;padding:1rem;background:#f9fafb;border-radius:0.5rem;margin-bottom:1rem}
    .draggable {padding:0.5rem 0.75rem;background:white;border:1px solid #d1d5db;border-radius:0.5rem;cursor:grab;font-size:0.85rem;font-weight:600; box-shadow: 0 1px 2px rgba(0,0,0,0.05);}
    .draggable:hover {border-color:var(--color-primary);transform:translateY(-1px); box-shadow: 0 4px 6px rgba(0,0,0,0.1);}
    .draggable.dragging {opacity:0.5}
    .draggable.placed {background:#f0fdf4;border-color:#86efac; cursor: default;}

    /* Ejercicios */
    .question-list {padding:1.5rem}
    .question-item {margin-bottom:2rem;padding-left:1.5rem;border-left:4px solid #fbbf24;transition:all 0.3s}
    .question-item.completed {border-left-color:#22c55e;background:#f0fdf4;padding:1rem;border-radius:0 0.5rem 0.5rem 0}
    .question-text {font-weight:600;margin-bottom:0.75rem;display:block; color: #374151;}
    textarea {width:100%;padding:1rem;border:1px solid #d1d5db;border-radius:0.5rem;font-family:inherit;font-size:0.9rem;resize:vertical;min-height:120px; transition: border 0.2s;}
    textarea:focus {outline:none;border-color:var(--color-primary);box-shadow:0 0 0 3px rgba(127,29,29,0.1)}

    /* Save System UI */
    .save-system-fab {position:fixed;bottom:2rem;right:2rem;z-index:90;}
    .fab-button {
        width:3.5rem;height:3.5rem;border-radius:50%;background:var(--color-primary);color:white;
        border:none;box-shadow:0 4px 12px rgba(0,0,0,0.3);cursor:pointer;
        display:flex;align-items:center;justify-content:center;font-size:1.5rem;
        transition:transform 0.2s;
    }
    .fab-button:hover {transform:scale(1.1);background:var(--color-primary-dark);}
    .save-menu {
        position:absolute;bottom:4.5rem;right:0;width:280px;background:white;
        border-radius:0.75rem;box-shadow:0 10px 25px -5px rgba(0,0,0,0.2);
        padding:1rem;border:1px solid #e5e7eb;display:none;opacity:0;transform:translateY(10px);
        transition:all 0.2s;
    }
    .save-menu.show {display:block;opacity:1;transform:translateY(0);}
    .save-action-btn {
        width:100%;text-align:left;padding:0.75rem;background:white;border:1px solid #e5e7eb;
        border-radius:0.5rem;margin-bottom:0.5rem;cursor:pointer;display:flex;align-items:center;gap:0.75rem;
        font-size:0.875rem;transition:background 0.2s;color:#374151;
    }
    .save-action-btn:hover {background:#f9fafb;border-color:#d1d5db;}
    .save-notification {
        position:fixed;bottom:2rem;left:50%;transform:translateX(-50%);
        background:rgba(31, 41, 55, 0.95);color:white;padding:0.75rem 1.5rem;
        border-radius:9999px;font-size:0.875rem;z-index:100;
        display:flex;align-items:center;gap:0.5rem;
        opacity:0;pointer-events:none;transition:opacity 0.3s;
    }
    .save-notification.show {opacity:1;}
    .hidden-file-input {display:none;}

    /* Achievements */
    .achievement-bar {padding:1rem;background:white;border-radius:0.75rem;margin-bottom:1rem; border: 1px solid #e5e7eb;}
    .achievement-list {display:flex;gap:0.5rem;flex-wrap:wrap;margin-top:0.5rem}
    .achievement {padding:0.5rem 0.75rem;background:#f3f4f6;border-radius:0.5rem;font-size:0.75rem;display:flex;align-items:center;gap:0.5rem;opacity:0.6; border: 1px solid transparent;}
    .achievement.unlocked {background:#fef3c7;border-color:#fcd34d;opacity:1; box-shadow: 0 1px 2px rgba(0,0,0,0.05);}

    /* Modal */
    .modal {display:none;position:fixed;inset:0;background:rgba(0,0,0,0.5);z-index:100;align-items:center;justify-content:center}
    .modal.show {display:flex}
    .modal-content {background:white;border-radius:1rem;padding:2rem;max-width:500px;margin:1rem;box-shadow:0 20px 25px -5px rgba(0,0,0,0.3); animation: slideIn 0.3s ease-out;}
    @keyframes slideIn { from { transform: translateY(20px); opacity: 0; } to { transform: translateY(0); opacity: 1; } }

    /* Flashcards Mejoradas */
    .flashcard-grid {display:grid;grid-template-columns:repeat(auto-fit,minmax(250px,1fr));gap:1.5rem;margin:2rem 0}
    .flashcard {background:white;border:1px solid #e5e7eb;border-radius:1rem;padding:2rem;text-align:center;cursor:pointer;transition:all 0.3s cubic-bezier(0.4, 0, 0.2, 1);box-shadow:0 4px 6px -1px rgba(0,0,0,0.1), 0 2px 4px -1px rgba(0,0,0,0.06);min-height:220px;display:flex;align-items:center;justify-content:center;flex-direction:column;position:relative;overflow:hidden}
    .flashcard:hover {transform:translateY(-5px);box-shadow:0 10px 15px -3px rgba(0,0,0,0.1), 0 4px 6px -2px rgba(0,0,0,0.05);border-color:var(--color-primary)}
    .flashcard-icon {font-size:2.5rem;margin-bottom:1rem;transition:transform 0.5s}
    .flashcard:hover .flashcard-icon {transform:rotateY(180deg)}
    .flashcard-front {font-weight:700;color:#111827;font-size:1.1rem;line-height:1.5}
    .flashcard-back {display:none;color:#4b5563;font-size:1rem;line-height:1.6;animation:fadeIn 0.3s ease-in}
    .flashcard.flipped {background:#fef2f2;border-color:var(--color-primary)}
    .flashcard.flipped .flashcard-front {display:none}
    .flashcard.flipped .flashcard-back {display:block}
    .flashcard.flipped .flashcard-icon {display:none}
    @keyframes fadeIn {from{opacity:0;transform:translateY(10px)}to{opacity:1;transform:translateY(0)}}

    @media (max-width: 768px) {
        .stats {display:none}
        .simulator-grid {grid-template-columns:1fr}
        .comparison-grid {grid-template-columns:1fr}
        .save-system-fab {bottom: 1rem; right: 1rem;}
        .drop-zones {grid-template-columns: 1fr;}
    }
</style>
</head>
<body>

<div id="loading" class="loading">
    <div class="spinner"></div>
    <p style="font-weight:600">Cargando Biof√≠sica Interactiva...</p>
</div>

<div id="save-notification" class="save-notification">
    <i class="fas fa-check-circle"></i> <span id="save-message">Progreso guardado</span>
</div>

<div id="app" class="hidden">
    <nav class="navbar">
        <div class="navbar-content">
            <div class="brand">
                <div class="brand-icon">üß¨</div>
                <div class="brand-text">
                    <h1>Biof√≠sica UACH</h1>
                    <p>Objeto 3: L√≠pidos y Membranas</p>
                </div>
            </div>
            <div class="stats">
                <div class="stat-item">
                    <div class="stat-value" id="stat-points">0</div>
                    <div class="stat-label">Puntos</div>
                </div>
                <div class="stat-item">
                    <div class="stat-value" id="stat-badges">0/10</div>
                    <div class="stat-label">Logros</div>
                </div>
                <div class="progress">
                    <div style="font-size:0.75rem;color:#6b7280">Progreso</div>
                    <div class="progress-bar"><div id="progress-fill" class="progress-fill"></div></div>
                </div>
            </div>
        </div>
    </nav>

    <!-- SISTEMA DE GUARDADO FLOTANTE -->
    <div class="save-system-fab">
        <div class="save-menu" id="save-menu">
            <div style="font-weight:700;color:#374151;margin-bottom:0.75rem;padding-bottom:0.5rem;border-bottom:1px solid #e5e7eb;display:flex;justify-content:space-between;align-items:center;">
                <span>Gesti√≥n de Progreso</span>
                <i class="fas fa-times" style="cursor:pointer" onclick="toggleSaveMenu()"></i>
            </div>
            <button class="save-action-btn" onclick="saveSystem.forceSave()">
                <i class="fas fa-save"></i> Guardar Ahora
            </button>
            <button class="save-action-btn" onclick="saveSystem.downloadBackup()">
                <i class="fas fa-download"></i> Descargar Respaldo
            </button>
            <button class="save-action-btn" onclick="document.getElementById('backup-upload').click()">
                <i class="fas fa-upload"></i> Restaurar Respaldo
            </button>
            <button class="save-action-btn" style="color:#ef4444;border-color:#fca5a5" onclick="saveSystem.clearProgress()">
                <i class="fas fa-trash-alt" style="color:#ef4444"></i> Borrar Todo
            </button>
            <div style="text-align:center;font-size:0.75rem;color:#6b7280;margin-top:0.5rem;" id="menu-last-save">No guardado a√∫n</div>
            <input type="file" id="backup-upload" class="hidden-file-input" accept=".json" onchange="saveSystem.restoreBackup(this)">
        </div>
        <button class="fab-button" onclick="toggleSaveMenu()" title="Men√∫ de Guardado">
            <i class="fas fa-save"></i>
        </button>
    </div>

    <main class="container">
        <div class="hero">
            <div class="hero-content">
                <h2>üéØ L√≠pidos y Membranas - Modo Interactivo</h2>
                <p>Completa las actividades, simula membranas y asegura tu aprendizaje.</p>
                <div class="alert alert-info" style="background:rgba(255,255,255,0.15);border:1px solid rgba(255,255,255,0.3);color:white;margin-top:1rem">
                    <i class="fas fa-shield-alt"></i> <strong>Sistema Seguro:</strong> Progreso auto-guardado. Usa el bot√≥n üíæ para descargar tu respaldo si cambias de equipo.
                </div>
            </div>
        </div>

        <div class="achievement-bar">
            <div style="font-weight:700;margin-bottom:0.5rem">üèÜ Tus Logros</div>
            <div class="achievement-list">
                <div class="achievement" id="ach-1"><span>üéì</span> Iniciado</div>
                <div class="achievement" id="ach-2"><span>üìö</span> Avanzado</div>
                <div class="achievement" id="ach-3"><span>‚ö°</span> Quiz Perfecto</div>
                <div class="achievement" id="ach-4"><span>üéØ</span> Clasificador</div>
                <div class="achievement" id="ach-5"><span>üß™</span> Cient√≠fico</div>
                <div class="achievement" id="ach-6"><span>üíØ</span> 50% Progreso</div>
                <div class="achievement" id="ach-7"><span>üî¨</span> Analista</div>
                <div class="achievement" id="ach-8"><span>üöÄ</span> Experto</div>
                <div class="achievement" id="ach-9"><span>üëë</span> Completado</div>
                <div class="achievement" id="ach-10"><span>‚≠ê</span> Maestro</div>
            </div>
        </div>

        <div class="tabs">
            <div class="tab active" onclick="showTab('quizzes')">üìù Quizzes</div>
            <div class="tab" onclick="showTab('simulator')">üß™ Simulador 3D</div>
            <div class="tab" onclick="showTab('drag-drop')">üéØ Clasificar</div>
            <div class="tab" onclick="showTab('ejercicios')">‚úçÔ∏è Ejercicios (Completo)</div>
            <div class="tab" onclick="showTab('calculator')">üî¢ Calculadora</div>
            <div class="tab" onclick="showTab('flashcards')">üé¥ Flashcards (40 Tarjetas)</div>
        </div>

        <!-- TAB: QUIZZES -->
        <div id="tab-quizzes" class="tab-content">
            <div class="card">
                <div class="card-header" style="background:#eff6ff;color:#1e40af">üìù Quizzes de Autoevaluaci√≥n (50 Preguntas)</div>
                <div class="quiz-container" id="quiz-container"></div>
            </div>
        </div>

        <!-- TAB: SIMULATOR -->
        <div id="tab-simulator" class="tab-content hidden">
            <div class="card">
                <div class="card-header" style="background:#f0fdf4;color:#166534">
                    <i class="fas fa-flask"></i> Laboratorio de Membranas
                </div>
                <div class="lipid-selector">
                    <button class="lipid-btn active" onclick="lipidSim.selectLipid('saturado')" id="btn-saturado">
                        <i class="fas fa-ruler-horizontal" style="color: var(--color-sat)"></i> <span>Saturado</span>
                    </button>
                    <button class="lipid-btn" onclick="lipidSim.selectLipid('cis')" id="btn-cis">
                        <i class="fas fa-wave-square" style="color: var(--color-cis)"></i> <span>Cis</span>
                    </button>
                    <button class="lipid-btn" onclick="lipidSim.selectLipid('trans')" id="btn-trans">
                        <i class="fas fa-exclamation-triangle" style="color: var(--color-trans)"></i> <span>Trans</span>
                    </button>
                    <button class="lipid-btn" onclick="lipidSim.selectLipid('colesterol')" id="btn-colesterol">
                        <i class="fas fa-gem" style="color: var(--color-chol)"></i> <span>Colesterol</span>
                    </button>
                    <button class="lipid-btn" onclick="lipidSim.selectLipid('mixto')" id="btn-mixto">
                        <i class="fas fa-layer-group" style="color: #4b5563"></i> <span>Mixto</span>
                    </button>
                </div>
                <div class="simulator-grid">
                    <div>
                        <h4 style="margin-bottom:0.5rem;font-size:0.9rem;color:#555">üî¨ Estructura Molecular Realista (Esqueletos de Carbono)</h4>
                        <div class="structure-viewer"><svg class="structure-svg" id="structure-svg" viewBox="0 0 300 250"></svg></div>
                        <div id="lipid-info"></div>
                    </div>
                    <div>
                        <h4 style="margin-bottom:0.5rem;font-size:0.9rem;color:#555">üß™ Comportamiento</h4>
                        <div class="membrane-simulation" id="membrane-sim"><div class="bilayer" id="bilayer"></div></div>
                        <div class="fluidity-meter">
                            <div style="display:flex;justify-content:space-between;margin-bottom:0.25rem;font-size:0.8rem"><strong>Fluidez</strong><span id="fluidity-text-val">--</span></div>
                            <div class="meter-bar"><div class="meter-fill" id="fluidity-fill" style="width:50%"></div></div>
                        </div>
                    </div>
                </div>
                
                <!-- Panel del Sistema Nervioso Restaurado -->
                <div class="nervous-system-panel">
                    <h3 style="margin-bottom:1rem;color:#92400e;display:flex;align-items:center;gap:0.5rem">üß† Impacto en el Sistema Nervioso</h3>
                    <p style="margin-bottom:1rem;font-size:0.9rem;color:#4b5563">La fluidez de membrana es CR√çTICA para la funci√≥n neuronal. Los √°cidos grasos trans alteran esta fluidez, causando disfunci√≥n.</p>
                    <div class="effects-grid">
                        <div class="effect-card severe">
                            <h4>üî¥ Mielina R√≠gida</h4>
                            <p>La vaina de mielina se vuelve quebradiza y a√≠sla mal la electricidad. Fallos motores.</p>
                        </div>
                        <div class="effect-card severe">
                            <h4>üî¥ Receptores Bloqueados</h4>
                            <p>Los receptores de serotonina/dopamina no pueden moverse para captar la se√±al.</p>
                        </div>
                        <div class="effect-card">
                            <h4>‚ö†Ô∏è Sinapsis Lenta</h4>
                            <p>La fusi√≥n de ves√≠culas (liberaci√≥n de neurotransmisor) se retarda.</p>
                        </div>
                    </div>
                </div>

                <div class="info-panel warning" style="margin: 0 1.5rem 1.5rem;"><strong>üí° Conclusi√≥n Cl√≠nica:</strong> Una dieta alta en grasas trans no solo afecta el coraz√≥n, sino que literalmente "endurece" el cerebro, afectando la cognici√≥n y el estado de √°nimo.</div>
            </div>
        </div>

        <!-- TAB: DRAG & DROP -->
        <div id="tab-drag-drop" class="tab-content hidden">
            <div class="card">
                <div class="card-header" style="background:#f0fdf4;color:#166534">üéØ Clasificaci√≥n de L√≠pidos (Expandido)</div>
                <div class="drag-drop-zone">
                    <div class="alert alert-info"><strong>Instrucciones:</strong> Arrastra cada mol√©cula a su categor√≠a qu√≠mica correcta.</div>
                    <div class="draggables" id="draggables-lipids"></div>
                    <div class="drop-zones">
                        <div class="drop-zone" data-category="acidos_grasos">
                            <div class="drop-zone-title">√Åcidos Grasos</div><div class="drop-items"></div>
                        </div>
                        <div class="drop-zone" data-category="membrana">
                            <div class="drop-zone-title">L√≠pidos de Membrana</div><div class="drop-items"></div>
                        </div>
                        <div class="drop-zone" data-category="esteroides_isoprenoides">
                            <div class="drop-zone-title">Esteroides e Isoprenoides</div><div class="drop-items"></div>
                        </div>
                        <div class="drop-zone" data-category="almacenamiento_ceras">
                            <div class="drop-zone-title">TAGs y Ceras</div><div class="drop-items"></div>
                        </div>
                    </div>
                    <button class="btn btn-primary" onclick="checkDragDrop()" style="margin-top:1rem">Verificar Clasificaci√≥n</button>
                    <button class="btn btn-secondary" onclick="resetDragDrop()" style="margin-top:1rem">Reiniciar</button>
                </div>
            </div>
        </div>

        <!-- TAB: EJERCICIOS (TEXTO COMPLETO) -->
        <div id="tab-ejercicios" class="tab-content hidden">
            <div id="preguntas-container"></div>
        </div>

        <!-- TAB: CALCULATOR -->
        <div id="tab-calculator" class="tab-content hidden">
            <div class="card">
                <div class="card-header" style="background:#faf5ff;color:#7c3aed">üî¢ Calculadoras Biof√≠sicas</div>
                
                <!-- Calculator 1: Iodine -->
                <div class="calculator" style="padding:1.5rem; border-bottom:1px solid #e5e7eb; margin-bottom:1.5rem">
                    <h3 style="margin-bottom:0.5rem;font-size:1.1rem;color:#4b5563;">1. √çndice de Yodo (Grado de Insaturaci√≥n)</h3>
                    <p style="font-size:0.9rem; color:#6b7280; margin-bottom:1rem">Mide la cantidad de yodo que reacciona con los dobles enlaces. A mayor √≠ndice, m√°s insaturaciones.</p>
                    
                    <div class="calc-input">
                        <label style="display:block; margin-bottom:0.5rem; font-weight:600; font-size:0.9rem;">Selecciona un √Åcido Graso:</label>
                        <select id="calc-fatty-acid" onchange="calculateIodine()" style="width:100%; padding:0.75rem; border-radius:0.5rem; border:1px solid #d1d5db; background:white;">
                            <option value="">-- Selecciona --</option>
                            <option value="0">√Åcido Este√°rico (18:0) - Saturado</option>
                            <option value="0">√Åcido Palm√≠tico (16:0) - Saturado</option>
                            <option value="90">√Åcido Oleico (18:1) - Monoinsaturado</option>
                            <option value="181">√Åcido Linol√©ico (18:2) - Poliinsaturado (œâ-6)</option>
                            <option value="273">√Åcido Linol√©nico (18:3) - Poliinsaturado (œâ-3)</option>
                            <option value="320">√Åcido Araquid√≥nico (20:4) - Poliinsaturado (œâ-6)</option>
                        </select>
                    </div>
                    
                    <div class="calc-result" id="calc-result" style="display:none; background:#f0fdf4; border:1px solid #bbf7d0; border-radius:0.5rem; padding:1rem; margin-top:1rem;">
                        <div style="font-size:0.85rem; color:#6b7280; text-transform:uppercase; letter-spacing:0.5px;">Resultado</div>
                        <div class="calc-result-value" id="calc-value" style="font-size:1.5rem; font-weight:700; color:#15803d; margin:0.25rem 0;">--</div>
                        <div id="calc-interpretation" style="font-weight:500; color:#166534;"></div>
                    </div>
                </div>

                <!-- Calculator 2: Melting Point -->
                <div class="calculator" style="padding:1.5rem;">
                    <h3 style="margin-bottom:0.5rem;font-size:1.1rem;color:#4b5563;">2. Estimador de Punto de Fusi√≥n</h3>
                    <p style="font-size:0.9rem; color:#6b7280; margin-bottom:1rem">Simula c√≥mo la longitud de la cadena y los dobles enlaces afectan la temperatura a la que una grasa se vuelve l√≠quida.</p>
                    
                    <div style="display:grid; grid-template-columns: 1fr 1fr; gap:1rem; margin-bottom:1rem;">
                        <div>
                            <label style="display:block; margin-bottom:0.5rem; font-weight:600; font-size:0.9rem;">Carbonos:</label>
                            <input type="number" id="calc-chain-length" min="4" max="24" value="18" oninput="calculateMeltingPoint()" style="width:100%; padding:0.5rem; border-radius:0.5rem; border:1px solid #d1d5db;">
                        </div>
                        <div>
                            <label style="display:block; margin-bottom:0.5rem; font-weight:600; font-size:0.9rem;">Dobles Enlaces:</label>
                            <input type="number" id="calc-double-bonds" min="0" max="6" value="0" oninput="calculateMeltingPoint()" style="width:100%; padding:0.5rem; border-radius:0.5rem; border:1px solid #d1d5db;">
                        </div>
                    </div>
                    
                    <div style="margin-bottom:1rem;">
                        <label style="display:block; margin-bottom:0.5rem; font-weight:600; font-size:0.9rem;">Configuraci√≥n:</label>
                        <select id="calc-config" onchange="calculateMeltingPoint()" style="width:100%; padding:0.5rem; border-radius:0.5rem; border:1px solid #d1d5db; background:white;">
                            <option value="cis">Cis (Natural - Curvo)</option>
                            <option value="trans">Trans (Industrial - Recto)</option>
                        </select>
                    </div>
                    
                    <div class="calc-result" id="calc-mp-result" style="display:block; background:#f8fafc; border:1px solid #e2e8f0; border-radius:0.5rem; padding:1rem;">
                        <div style="display:flex; justify-content:space-between; align-items:center;">
                            <div>
                                <div style="font-size:0.85rem; color:#6b7280;">Punto de Fusi√≥n Estimado:</div>
                                <div class="calc-result-value" id="calc-mp-value" style="font-size:1.8rem; font-weight:700; color:#334155;">70 ¬∞C</div>
                            </div>
                            <div id="calc-mp-state" style="font-size:2.5rem;">üß±</div>
                        </div>
                        <div id="calc-mp-interpretation" style="font-weight:600; color:#475569; margin-top:0.5rem; padding-top:0.5rem; border-top:1px dashed #cbd5e1;">S√≥lido a temperatura ambiente (25¬∞C)</div>
                    </div>
                </div>
            </div>
        </div>

        <!-- TAB: FLASHCARDS -->
        <div id="tab-flashcards" class="tab-content hidden">
            <div class="card">
                <div class="card-header" style="background:#fef2f2;color:#991b1b">üé¥ Repaso R√°pido (40 Tarjetas)</div>
                <div style="padding:1.5rem"><div class="flashcard-grid" id="flashcard-container"></div></div>
            </div>
        </div>

        <footer>
            <p>Biof√≠sica UACH - Versi√≥n Completa Actualizada</p>
            <p style="font-size:0.75rem;margin-top:0.25rem;color:#9ca3af" id="footer-last-save">-</p>
        </footer>
    </main>
</div>

<!-- Modal -->
<div id="achievement-modal" class="modal">
    <div class="modal-content">
        <div class="modal-header">üéâ ¬°Logro Desbloqueado!</div>
        <div style="text-align:center"><div style="font-size:4rem;margin:1rem 0" id="modal-badge"></div><h3 id="modal-title"></h3><p id="modal-description" style="color:#6b7280"></p><div style="margin-top:1rem;color:var(--color-primary);font-weight:700;font-size:1.5rem">+<span id="modal-points"></span> pts</div></div>
        <div class="modal-footer"><button class="btn btn-primary" onclick="closeAchievementModal()">¬°Genial!</button></div>
    </div>
</div>

<script>
// ============================================
// SISTEMA DE GUARDADO ROBUSTO
// ============================================
const saveSystem = {
    key: 'bio_uach_obj3_master',
    keyStats: 'bio_stats_master',
    init: function() {
        this.load();
        setInterval(() => this.save(true), 10000);
        window.addEventListener('beforeunload', () => this.save(false));
    },
    save: function(silent) {
        try {
            localStorage.setItem(this.key, JSON.stringify(respuestas));
            localStorage.setItem(this.keyStats, JSON.stringify(userStats));
            this.updateLastSaveTime();
            if(!silent) this.showNotification('Progreso guardado');
        } catch(e) { console.error(e); }
    },
    forceSave: function() { this.save(false); toggleSaveMenu(); },
    load: function() {
        try {
            const d = localStorage.getItem(this.key);
            const s = localStorage.getItem(this.keyStats);
            if(d) respuestas = JSON.parse(d);
            if(s) userStats = JSON.parse(s);
            updateStats();
            this.updateLastSaveTime();
            if(currentTab === 'ejercicios') renderPreguntas();
        } catch(e) { console.error(e); }
    },
    downloadBackup: function() {
        this.save(true);
        const blob = new Blob([JSON.stringify({respuestas, userStats, date: new Date()})], {type:'application/json'});
        const a = document.createElement('a'); a.href = URL.createObjectURL(blob); a.download = 'biofisica_backup.json'; a.click();
        toggleSaveMenu();
    },
    restoreBackup: function(input) {
        const file = input.files[0];
        if(!file) return;
        const r = new FileReader();
        r.onload = e => {
            try {
                const b = JSON.parse(e.target.result);
                if(b.respuestas) {
                    respuestas = b.respuestas; userStats = b.stats || userStats;
                    this.save(false); updateStats(); renderPreguntas();
                    this.showNotification('Respaldo restaurado');
                    setTimeout(() => location.reload(), 1000);
                }
            } catch(x) { alert('Error en archivo'); }
        };
        r.readAsText(file);
        toggleSaveMenu();
    },
    clearProgress: function() {
        if(confirm("¬øBorrar todo?")) { localStorage.removeItem(this.key); localStorage.removeItem(this.keyStats); location.reload(); }
    },
    updateLastSaveTime: function() {
        const t = 'Guardado: ' + new Date().toLocaleTimeString();
        document.getElementById('menu-last-save').innerText = t;
        const f = document.getElementById('footer-last-save'); if(f) f.innerText = t;
    },
    showNotification: function(msg) {
        const n = document.getElementById('save-notification');
        document.getElementById('save-message').innerText = msg;
        n.classList.add('show'); setTimeout(() => n.classList.remove('show'), 3000);
    }
};

function toggleSaveMenu() { document.getElementById('save-menu').classList.toggle('show'); }

// ============================================
// DATOS DE CONTENIDO (COMPLETO DEL ODT)
// ============================================
var respuestas = {};
var userStats = { points: 0, badges: 0, achievements: {}, quizzesCompleted: 0 };
var currentTab = 'quizzes';

// Preguntas extra√≠das TEXTUALMENTE del ODT
var preguntasData = {
    pre: [
        "¬øQu√© caracter√≠sticas comunes cree usted que tienen sustancias como el aceite de cocina, la mantequilla y el colesterol para ser agrupadas como \"l√≠pidos\"?",
        "Mencione tres funciones que conozca de los l√≠pidos en el cuerpo humano.",
        "¬øQu√© diferencia cree que existe entre las grasas que son s√≥lidas a temperatura ambiente (como la manteca) y las que son l√≠quidas (como el aceite de oliva)?",
        "¬øHa escuchado hablar de las grasas \"buenas\" y \"malas\" (saturadas vs. insaturadas)? ¬øQu√© idea tiene sobre ellas?",
        "Todas nuestras c√©lulas est√°n rodeadas por una membrana. ¬øQu√© tipo de l√≠pidos cree que la forman y por qu√© son adecuados para esa funci√≥n?",
        "¬øQu√© son las vitaminas liposolubles? Mencione alguna que conozca.",
        "¬øPor qu√© cree que las grasas son una fuente de energ√≠a tan concentrada en comparaci√≥n con los carbohidratos?",
        "¬øQu√© entiende por el t√©rmino \"colesterol\"? ¬øEs siempre perjudicial para la salud?",
        "¬øC√≥mo cree que nuestro cuerpo digiere y absorbe las grasas que comemos, si la sangre es un medio acuoso donde las grasas no se disuelven?",
        "¬øHa o√≠do hablar de los √°cidos grasos omega-3 y omega-6? ¬øEn qu√© alimentos se encuentran com√∫nmente?"
    ],
    sec31: {
        titulo: "3.1 Introducci√≥n y funciones",
        dev: ["Defina qu√© son los l√≠pidos bas√°ndose en sus propiedades de solubilidad.", "Enumere y describa brevemente las diversas funciones que desempe√±an los l√≠pidos en los organismos vivos.", "Explique por qu√© los l√≠pidos son una forma eficiente de almacenamiento de energ√≠a en comparaci√≥n con los carbohidratos, como el gluc√≥geno.", "Clasifique los l√≠pidos en las 6 categor√≠as principales mencionadas en el texto de McKee."],
        app: ["El tejido adiposo, adem√°s de ser una reserva de energ√≠a, cumple una funci√≥n de aislamiento t√©rmico. Explique esta propiedad bas√°ndose en las caracter√≠sticas de los triacilgliceroles.", "Algunas aves acu√°ticas cubren sus plumas con secreciones de gl√°ndulas especializadas. ¬øQu√© tipo de l√≠pidos esperar√≠a encontrar en estas secreciones y cu√°l es su funci√≥n?", "Las vitaminas A, D, E y K se conocen como liposolubles. ¬øQu√© implica esto para su absorci√≥n y almacenamiento en el cuerpo? ¬øQu√© problemas podr√≠a causar una dieta extremadamente baja en grasas?"]
    },
    sec32: {
        titulo: "3.2 √Åcidos grasos",
        dev: ["Describa la estructura qu√≠mica general de un √°cido graso. Explique el sistema de numeraci√≥n y la designaci√≥n de los carbonos Œ±, Œ≤ y œâ (omega).", "¬øCu√°l es la diferencia estructural entre un √°cido graso saturado y uno insaturado?", "Explique c√≥mo la presencia de un doble enlace cis afecta la forma de la cadena hidrocarbonada de un √°cido graso.", "Relacione la estructura (saturaci√≥n y presencia de dobles enlaces cis) de los √°cidos grasos con sus propiedades f√≠sicas, como el punto de fusi√≥n.", "Defina los t√©rminos monoinsaturado y poliinsaturado.", "¬øQu√© son los √°cidos grasos esenciales? Nombre los dos principales para los humanos y explique por qu√© son esenciales.", "Explique la nomenclatura omega (œâ) para los √°cidos grasos insaturados, usando los √°cidos grasos omega-3 y omega-6 como ejemplos."],
        app: ["El √°cido este√°rico (18:0) es un s√≥lido a temperatura ambiente, mientras que el √°cido oleico (18:1Œî‚Åπ) es l√≠quido. Ambos tienen 18 carbonos. Explique esta diferencia.", "Los aceites vegetales pueden convertirse en grasas s√≥lidas como la margarina mediante un proceso de hidrogenaci√≥n parcial. ¬øQu√© ocurre qu√≠micamente en este proceso y qu√© tipo de √°cidos grasos (un subproducto no deseado) se pueden formar?", "Ordene los siguientes √°cidos grasos de menor a mayor punto de fusi√≥n y justifique su respuesta: a. √Åcido palm√≠tico (16:0) b. √Åcido linol√©nico (18:3Œî‚Åπ,¬π¬≤,¬π‚Åµ) c. √Åcido este√°rico (18:0) d. √Åcido oleico (18:1Œî‚Åπ)", "El √°cido araquid√≥nico [20:4(5,8,11,14)] es precursor de los eicosanoides. ¬øEs un √°cido graso omega-3 o omega-6? Justifique su respuesta."]
    },
    sec33: {
        titulo: "3.3 Triacilgliceroles y ceras",
        dev: ["Describa la estructura de un triacilglicerol (TAG). ¬øQu√© mol√©culas lo componen y qu√© tipo de enlace las une?", "¬øPor qu√© los TAGs son considerados \"grasas neutras\" y son altamente hidrof√≥bicos?", "¬øCu√°l es la principal funci√≥n de los triacilgliceroles en los animales? Describa las c√©lulas especializadas en su almacenamiento.", "Diferencie entre grasas y aceites seg√∫n su estado f√≠sico a temperatura ambiente y su composici√≥n de √°cidos grasos.", "¬øQu√© es la saponificaci√≥n? Describa la reacci√≥n qu√≠mica que ocurre al tratar un triacilglicerol con una base fuerte como el NaOH.", "Describa la composici√≥n qu√≠mica general de las ceras. ¬øQu√© son los √©steres de cera?", "¬øCu√°l es la funci√≥n principal de las ceras en la naturaleza? Proporcione ejemplos en plantas y animales."],
        app: ["Un aceite vegetal, como el de ma√≠z, es l√≠quido a temperatura ambiente, mientras que la grasa animal, como la de res, es s√≥lida. ¬øQu√© puede inferir sobre la composici√≥n de √°cidos grasos de cada uno?", "El proceso de digesti√≥n de grasas requiere que estas se emulsionen en el intestino. Explique c√≥mo el jab√≥n (sales de √°cidos grasos) act√∫a como agente emulsionante para dispersar gotas de aceite en agua, relacion√°ndolo con la digesti√≥n.", "La cera de abejas es s√≥lida y completamente insoluble en agua, lo que permite que el panal sea impermeable. ¬øQu√© caracter√≠sticas estructurales de sus componentes (√©steres de cera) le confieren estas propiedades?"]
    },
    sec34: {
        titulo: "3.4 Fosfol√≠pidos",
        dev: ["Describa la naturaleza anfip√°tica de los fosfol√≠pidos. Identifique sus dominios hidrof√≥bico e hidrof√≠lico.", "Explique por qu√© los fosfol√≠pidos forman espont√°neamente una bicapa en un medio acuoso. ¬øQu√© fuerzas impulsan esta organizaci√≥n?", "¬øCu√°les son las dos clases principales de fosfol√≠pidos?", "Dibuje la estructura general de un fosfoglic√©rido. ¬øCu√°l es su mol√©cula precursora?", "Nombre al menos cuatro alcoholes que pueden esterificarse al grupo fosfato de un fosfoglic√©rido y los fosfol√≠pidos resultantes.", "¬øQu√© es la cardiolipina y en qu√© membrana celular se encuentra predominantemente? ¬øCu√°l es su funci√≥n?", "Describa el rol de la dipalmitoilfosfatidilcolina (DPPC) como componente principal del surfactante pulmonar. ¬øQu√© es el s√≠ndrome de dificultad respiratoria (RDS)?"],
        app: ["La membrana plasm√°tica es fluida y semipermeable. Explique c√≥mo la composici√≥n de √°cidos grasos (saturados vs. insaturados) en los fosfol√≠pidos influye en la fluidez de la membrana.", "El fosfatidilinositol 4,5-bifosfato (PIP2) es un fosfol√≠pido de membrana que act√∫a en la transducci√≥n de se√±ales. La enzima fosfolipasa C lo escinde. ¬øQu√© dos mol√©culas mensajeras se generan y cu√°l es su funci√≥n?", "Las membranas biol√≥gicas son asim√©tricas en cuanto a su composici√≥n de fosfol√≠pidos. Por ejemplo, la fosfatidilserina (PS) se encuentra principalmente en la monocapa interna de la membrana plasm√°tica. ¬øQu√© importancia biol√≥gica tiene esta asimetr√≠a (p. ej., en la apoptosis)?", "Las fosfolipasas son enzimas que degradan los fosfol√≠pidos. La fosfolipasa A2 (PLA2) es un componente del veneno de algunas serpientes. ¬øQu√© producto se libera por su acci√≥n sobre los fosfol√≠pidos de membrana y c√≥mo contribuye esto a la toxicidad del veneno?"]
    },
    sec35: {
        titulo: "3.5 Esfingol√≠pidos",
        dev: ["¬øCu√°l es la mol√©cula base (alcohol) de los esfingol√≠pidos, que reemplaza al glicerol?", "Defina el t√©rmino ceramida. ¬øQu√© componentes la forman y qu√© tipo de enlace los une?", "Describa la estructura de la esfingomielina. ¬øA qu√© clase de l√≠pidos pertenece? ¬øEn qu√© estructura del sistema nervioso es abundante?", "¬øQu√© son los glicoesfingol√≠pidos? ¬øEn qu√© se diferencian de la esfingomielina?", "Defina y diferencie los cerebr√≥sidos y los gangli√≥sidos bas√°ndose en su grupo de cabeza polar.", "¬øQu√© son las esfingolipidosis? Describa la causa de Tay-Sachs, mencionando la enzima deficiente y el l√≠pido que se acumula."],
        app: ["La vaina de mielina que a√≠sla los axones neuronales es rica en esfingomielina y galactocerebr√≥sidos. ¬øQu√© propiedades confieren estos l√≠pidos a la mielina?", "Los gangli√≥sidos se encuentran en la superficie externa de las membranas celulares y act√∫an como receptores. Por ejemplo, la toxina del c√≥lera se une al gangli√≥sido GM1. Explique c√≥mo la porci√≥n de carbohidrato permite esto.", "En la enfermedad de Gaucher, hay una deficiencia de Œ≤-glucosidasa. ¬øEn qu√© org√°nulo celular esperar√≠a que ocurriera la acumulaci√≥n de glucocerebr√≥sido y por qu√©?", "Compare y contraste la estructura de la fosfatidilcolina con la de la esfingomielina. ¬øEn qu√© se diferencian sus \"esqueletos\"?"]
    },
    sec36: {
        titulo: "3.6 Isoprenoides",
        dev: ["¬øCu√°l es la unidad estructural repetitiva de cinco carbonos que forma a todos los isoprenoides?", "Distinga entre terpenos y esteroides.", "Clasifique los terpenos seg√∫n el n√∫mero de unidades de isopreno y d√© un ejemplo de cada uno.", "¬øQu√© son los terpenoides mixtos? Mencione dos ejemplos que sean vitaminas o coenzimas importantes.", "Describa la estructura del n√∫cleo esteroideo (cuatro anillos fusionados).", "¬øCu√°l es el esterol m√°s importante en los tejidos animales y precursor de otras mol√©culas? Enumere tres tipos de mol√©culas que se sintetizan a partir de √©l.", "Nombre las principales clases de hormonas esteroideas y mencione una funci√≥n para cada una."],
        app: ["El Œ≤-caroteno es el precursor de la vitamina A (retinol), esencial para la visi√≥n. Investigue c√≥mo se convierte el Œ≤-caroteno en vitamina A.", "El colesterol es una mol√©cula anfip√°tica y componente de membranas. ¬øC√≥mo se orienta en la bicapa lip√≠dica y cu√°l es su efecto sobre la fluidez?", "Los √°cidos biliares, como el √°cido c√≥lico, son derivados del colesterol. Compare la estructura del colesterol y el √°cido c√≥lico. ¬øQu√© modificaciones hacen que el √°cido c√≥lico sea un mejor agente emulsionante?", "Los gluc√≥sidos card√≠acos, como la digitoxina, se usan para tratar la insuficiencia card√≠aca. ¬øQu√© caracter√≠stica estructural los distingue y cu√°l es su mecanismo de acci√≥n?"]
    },
    sec37: {
        titulo: "3.7 Eicosanoides",
        dev: ["¬øQu√© son los eicosanoides y a partir de qu√© tipo de √°cido graso se derivan principalmente?", "Nombre las tres clases principales de eicosanoides.", "¬øC√≥mo se liberan los precursores de los eicosanoides de los fosfol√≠pidos de la membrana? ¬øQu√© enzima es responsable?", "Compare a los eicosanoides con las hormonas endocrinas en t√©rminos de sitio de producci√≥n y modo de acci√≥n.", "La enzima ciclooxigenasa (COX) es clave en la s√≠ntesis de prostaglandinas. ¬øQu√© reacci√≥n cataliza?", "¬øQu√© funciones fisiol√≥gicas tienen las prostaglandinas y los tromboxanos? Mencione un rol en la inflamaci√≥n y otro en la hemostasia."],
        app: ["La aspirina y otros AINE inhiben la enzima COX. Explique c√≥mo esta inhibici√≥n produce sus efectos antiinflamatorios.", "Existen dos isoformas: COX-1 y COX-2. ¬øQu√© ventaja terap√©utica ofrecen los inhibidores selectivos de COX-2?", "El tromboxano A2 (TXA2) promueve agregaci√≥n plaquetaria, mientras que la prostaciclina (PGI2) la inhibe. Explique c√≥mo el balance entre estas dos mol√©culas mantiene la homeostasis vascular.", "Los corticosteroides son potentes antiinflamatorios que inhiben la fosfolipasa A2. Compare este mecanismo con el de la aspirina. ¬øPor qu√© los corticosteroides tienen un efecto m√°s amplio?"]
    },
    sec38: {
        titulo: "3.8 Digesti√≥n de l√≠pidos",
        dev: ["Describa los desaf√≠os de la digesti√≥n de l√≠pidos en el ambiente acuoso del tracto gastrointestinal.", "¬øCu√°l es el papel de las sales biliares? Explique el proceso de emulsificaci√≥n.", "¬øQu√© enzima pancre√°tica hidroliza los triacilgliceroles en el intestino delgado? ¬øQu√© productos se obtienen?", "Una vez digeridos, ¬øc√≥mo se absorben los productos de la digesti√≥n en las c√©lulas de la mucosa intestinal?", "Dentro de las c√©lulas intestinales, los l√≠pidos se reensamblan en TAGs. ¬øC√≥mo se empaquetan y transportan? Nombre la lipoprote√≠na.", "Describa el destino de los quilomicrones en la circulaci√≥n. ¬øQu√© enzima libera los √°cidos grasos en los tejidos perif√©ricos?"],
        app: ["Un paciente con una obstrucci√≥n del conducto biliar presenta esteatorrea (grasa en las heces). Relacione la falta de bilis en el intestino con este s√≠ntoma.", "La olestra es un sustituto de la grasa artificial que no puede ser hidrolizada por las lipasas humanas. ¬øPor qu√© no se absorbe y, por lo tanto, no aporta calor√≠as? ¬øQu√© efectos secundarios gastrointestinales podr√≠a causar?", "¬øPor qu√© una dieta rica en fibra soluble puede ayudar a reducir los niveles de colesterol en sangre? (Pista: considere el efecto de la fibra sobre la reabsorci√≥n de sales biliares en el ciclo enterohep√°tico).", "Los pacientes con deficiencia de la enzima lipoprote√≠na lipasa (LPL) o de su cofactor ApoC-II presentan niveles extremadamente altos de triacilgliceroles en sangre despu√©s de una comida (hiperquilomicronemia familiar). Explique el mecanismo molecular de esta condici√≥n."]
    },
    caso: {
        titulo: "Caso Cl√≠nico Integradora",
        dev: ["Identifiquen los principales tipos de l√≠pidos que probablemente predominan en la dieta del paciente (p. ej., saturados, insaturados, trans, colesterol).", "Expliquen, a nivel molecular, por qu√© una dieta rica en √°cidos grasos saturados y trans tiende a elevar los niveles de colesterol LDL.", "Describan la funci√≥n de las lipoprote√≠nas LDL y HDL en el transporte del colesterol. Expliquen por qu√© el LDL se asocia con riesgo cardiovascular (aterosclerosis) y el HDL con protecci√≥n.", "Expliquen el mecanismo de acci√≥n de las estatinas a nivel enzim√°tico, identificando la enzima clave que inhiben en la ruta de s√≠ntesis del colesterol.", "Se recomienda dieta con pescado graso y aceite de oliva. ¬øQu√© tipo de √°cidos grasos predominan (omega-3, monoinsaturados)?", "Expliquen c√≥mo el consumo de √°cidos grasos omega-3 puede ser beneficioso. Relacionen el precursor (√°cido araquid√≥nico vs. EPA) con la producci√≥n de eicosanoides (tromboxanos) y su efecto sobre la agregaci√≥n plaquetaria y la inflamaci√≥n."],
        app: []
    }
};

// Quizzes EXPANDIDOS (50 Preguntas)
var quizzes = [
    {q: "¬øCu√°l es la caracter√≠stica fisicoqu√≠mica fundamental que define a los l√≠pidos como grupo?", opts: ["Son pol√≠meros formados por nucle√≥tidos", "Son insolubles en agua y solubles en solventes org√°nicos", "Son solubles en agua y forman puentes de hidr√≥geno f√°cilmente", "Todos contienen nitr√≥geno en su estructura"], correct: 1, explanation: "Esta propiedad, conocida como hidrofobicidad o naturaleza anfip√°tica, es el criterio principal para clasificar biomol√©culas como l√≠pidos."},
    {q: "¬øCu√°l es la funci√≥n principal de los triacilgliceroles (triglic√©ridos) en los animales?", opts: ["Formar la bicapa lip√≠dica de las membranas", "Actuar como hormonas se√±alizadoras", "Almacenamiento de energ√≠a a largo plazo", "Catalizar reacciones qu√≠micas"], correct: 2, explanation: "Los triglic√©ridos son la forma m√°s concentrada de almacenamiento de energ√≠a metab√≥lica."},
    {q: "Estructuralmente, ¬øqu√© diferencia a un √°cido graso saturado de uno insaturado?", opts: ["El saturado contiene dobles enlaces carbono-carbono", "El saturado carece de dobles enlaces carbono-carbono", "El insaturado tiene una cadena m√°s corta", "El saturado tiene un grupo fosfato"], correct: 1, explanation: "Los √°cidos grasos saturados tienen una cadena hidrocarbonada con solo enlaces simples, lo que les da una estructura recta."},
    {q: "¬øQu√© efecto tiene un doble enlace en configuraci√≥n CIS sobre la estructura de un √°cido graso?", opts: ["Mantiene la cadena recta y r√≠gida", "Produce una curvatura o quiebre en la cadena", "Aumenta significativamente el punto de fusi√≥n", "Permite un empaquetamiento muy denso"], correct: 1, explanation: "La configuraci√≥n CIS coloca los hidr√≥genos del mismo lado, provocando una angulaci√≥n en la cadena que impide el empaquetamiento compacto."},
    {q: "¬øPor qu√© las grasas TRANS se consideran perjudiciales para la salud cardiovascular?", opts: ["Porque se comportan estructuralmente como grasas saturadas", "Porque son demasiado fluidas a temperatura corporal", "Porque el cuerpo las degrada demasiado r√°pido", "Porque disminuyen los niveles de colesterol LDL"], correct: 0, explanation: "Aunque tienen dobles enlaces, su configuraci√≥n lineal les permite empaquetarse densamente y elevar el colesterol LDL."},
    {q: "¬øQu√© nomenclatura se utiliza para indicar la posici√≥n del primer doble enlace contando desde el extremo metilo (CH3) de un √°cido graso?", opts: ["Delta (Œî)", "Alfa (Œ±)", "Omega (œâ)", "Beta (Œ≤)"], correct: 2, explanation: "La nomenclatura Omega cuenta los carbonos comenzando desde el final de la cola (el extremo metilo)."},
    {q: "¬øCu√°les son los √°cidos grasos esenciales para los humanos?", opts: ["√Åcido palm√≠tico y este√°rico", "√Åcido linoleico y √°cido alfa-linol√©nico", "√Åcido oleico y araquid√≥nico", "Colesterol y fosfol√≠pidos"], correct: 1, explanation: "El cuerpo humano no puede introducir dobles enlaces m√°s all√° del carbono 9, por lo que necesita ingerir estos precursores omega-6 y omega-3."},
    {q: "¬øQu√© reacci√≥n qu√≠mica ocurre cuando se trata un triglic√©rido con una base fuerte (como NaOH) para producir jab√≥n?", opts: ["Esterificaci√≥n", "Saponificaci√≥n", "Hidrogenaci√≥n", "Oxidaci√≥n"], correct: 1, explanation: "La saponificaci√≥n es la hidr√≥lisis alcalina de los enlaces √©ster de las grasas, produciendo glicerol y sales de √°cidos grasos (jab√≥n)."},
    {q: "¬øCu√°l es la funci√≥n biol√≥gica principal de las ceras?", opts: ["Se√±alizaci√≥n celular", "Impermeabilizaci√≥n y protecci√≥n", "Transporte de ox√≠geno", "Cat√°lisis enzim√°tica"], correct: 1, explanation: "Debido a su naturaleza extremadamente hidrof√≥bica, las ceras recubren hojas, plumas y piel para repeler el agua."},
    {q: "¬øQu√© propiedad de los fosfol√≠pidos es cr√≠tica para la formaci√≥n de membranas celulares?", opts: ["Son completamente hidrof√≥bicos", "Son mol√©culas anfip√°ticas", "Son solubles en agua", "Tienen estructura de anillo r√≠gido"], correct: 1, explanation: "Tener una cabeza polar (hidrof√≠lica) y colas apolares (hidrof√≥bicas) permite que se auto-organicen en bicapas en medio acuoso."},
    {q: "En un fosfoglic√©rido, ¬øqu√© componente act√∫a como esqueleto central?", opts: ["Esfingosina", "Glicerol", "Colesterol", "Glucosa"], correct: 1, explanation: "El glicerol proporciona los tres carbonos a los que se unen los √°cidos grasos y el grupo fosfato."},
    {q: "¬øQu√© fosfol√≠pido es el componente principal del surfactante pulmonar?", opts: ["Fosfatidilinositol", "Dipalmitoilfosfatidilcolina (DPPC)", "Cardiolipina", "Esfingomielina"], correct: 1, explanation: "La DPPC reduce la tensi√≥n superficial en los alv√©olos, evitando que colapsen."},
    {q: "¬øCu√°l es la mol√©cula base exclusiva de los esfingol√≠pidos?", opts: ["Glicerol", "Esfingosina", "Isopreno", "√Åcido fosfat√≠dico"], correct: 1, explanation: "La esfingosina es un aminoalcohol de cadena larga que sirve de esqueleto para todos los esfingol√≠pidos."},
    {q: "La vaina de mielina, crucial para la transmisi√≥n nerviosa, es rica en:", opts: ["Triglic√©ridos", "Esfingomielina", "√Åcidos biliares", "Cardiolipina"], correct: 1, explanation: "Como su nombre indica, es el componente fosfol√≠pido/esfingol√≠pido principal de la mielina."},
    {q: "¬øQu√© es una ceramida?", opts: ["Un √°cido graso unido a glicerol", "Esfingosina + √Åcido graso", "Esfingosina + Fosfato", "Colesterol + √Åcido graso"], correct: 1, explanation: "La uni√≥n de un √°cido graso al grupo amino de la esfingosina mediante enlace amida forma la ceramida, base de todos los esfingol√≠pidos."},
    {q: "¬øCu√°l es la causa bioqu√≠mica de la enfermedad de Tay-Sachs?", opts: ["Deficiencia de la enzima Hexosaminidasa A", "Deficiencia de insulina", "Acumulaci√≥n de colesterol", "Deficiencia de esfingomielinasa"], correct: 0, explanation: "La falta de esta enzima impide la degradaci√≥n del gangli√≥sido GM2, que se acumula en las neuronas causando da√±o."},
    {q: "¬øQu√© l√≠pido se acumula en los lisosomas en la enfermedad de Gaucher?", opts: ["Glucocerebr√≥sido", "Esfingomielina", "Gangli√≥sido GM2", "Ceramida"], correct: 0, explanation: "La deficiencia de beta-glucosidasa lleva a la acumulaci√≥n de este l√≠pido."},
    {q: "¬øCu√°l es la unidad estructural b√°sica de los terpenos y esteroides?", opts: ["Amino√°cido", "Unidad de isopreno", "√Åcido graso", "Glucosa"], correct: 1, explanation: "Es una unidad de 5 carbonos que se polimeriza para formar terpenos y el esqueleto de esteroides."},
    {q: "¬øCu√°l es la estructura caracter√≠stica del colesterol y otros esteroides?", opts: ["Una cadena larga lineal", "Un n√∫cleo de cuatro anillos fusionados", "Un anillo de benceno", "Un grupo fosfato y dos colas"], correct: 1, explanation: "El n√∫cleo esteroideo (ciclopentanoperhidrofenantreno) consta de 3 anillos de 6 carbonos y 1 anillo de 5 carbonos."},
    {q: "¬øQu√© efecto tiene el colesterol en la membrana celular a temperaturas fisiol√≥gicas?", opts: ["Aumenta excesivamente la fluidez", "Act√∫a como un amortiguador (buffer) de fluidez", "Destruye la bicapa lip√≠dica", "Hace la membrana impermeable a todo"], correct: 1, explanation: "Reduce la fluidez a altas temperaturas pero evita la cristalizaci√≥n (congelamiento) a bajas temperaturas."},
    {q: "Los √°cidos biliares se sintetizan a partir de:", opts: ["Glucosa", "Colesterol", "Prote√≠nas", "Vitamina C"], correct: 1, explanation: "El h√≠gado convierte el colesterol en √°cidos biliares para ayudar en la digesti√≥n de grasas."},
    {q: "¬øQu√© vitamina liposoluble se deriva estructuralmente de un esteroide?", opts: ["Vitamina A", "Vitamina D", "Vitamina E", "Vitamina K"], correct: 1, explanation: "La vitamina D se sintetiza a partir de un derivado del colesterol mediante la luz UV."},
    {q: "¬øCu√°l es el precursor lip√≠dico inmediato de los eicosanoides?", opts: ["√Åcido palm√≠tico", "√Åcido araquid√≥nico", "Colesterol", "√Åcido este√°rico"], correct: 1, explanation: "Este √°cido graso poliinsaturado de 20 carbonos se libera de la membrana para iniciar la s√≠ntesis."},
    {q: "Las prostaglandinas act√∫an principalmente como:", opts: ["Hormonas sist√©micas de larga duraci√≥n", "Mensajeros locales (paracrinos/autocrinos)", "Reservas de energ√≠a", "Componentes estructurales de membrana"], correct: 1, explanation: "Act√∫an cerca del sitio donde se producen mediando inflamaci√≥n y dolor."},
    {q: "¬øQu√© enzima es inhibida por los AINEs (como la aspirina e ibuprofeno)?", opts: ["Lipoprote√≠na lipasa", "Ciclooxigenasa (COX)", "Fosfolipasa A2", "HMG-CoA reductasa"], correct: 1, explanation: "La inhibici√≥n de la COX bloquea la conversi√≥n de √°cido araquid√≥nico en prostaglandinas pro-inflamatorias."},
    {q: "¬øCu√°l es la funci√≥n principal de los tromboxanos?", opts: ["Vasodilataci√≥n", "Promover la agregaci√≥n plaquetaria y vasoconstricci√≥n", "Inducir sue√±o", "Digesti√≥n de l√≠pidos"], correct: 1, explanation: "Son cr√≠ticos para la formaci√≥n de co√°gulos sangu√≠neos (hemostasia)."},
    {q: "¬øCu√°l es el papel principal de las sales biliares en la digesti√≥n?", opts: ["Hidrolizar triglic√©ridos", "Emulsificar las grasas", "Transportar l√≠pidos en sangre", "Sintetizar colesterol"], correct: 1, explanation: "Act√∫an como detergentes biol√≥gicos, rompiendo grandes gotas de grasa en micelas peque√±as para facilitar la acci√≥n enzim√°tica."},
    {q: "¬øQu√© enzima pancre√°tica realiza la mayor parte de la digesti√≥n de triglic√©ridos?", opts: ["Amilasa", "Lipasa pancre√°tica", "Pepsina", "Tripsina"], correct: 1, explanation: "Hidroliza los triglic√©ridos en √°cidos grasos libres y 2-monoacilglicerol."},
    {q: "¬øD√≥nde se ensamblan los quilomicrones?", opts: ["En el h√≠gado", "En el enterocito (c√©lula intestinal)", "En el tejido adiposo", "En la sangre"], correct: 1, explanation: "Se forman para transportar los l√≠pidos de la dieta reci√©n absorbidos."},
    {q: "¬øCu√°l es la funci√≥n principal de los quilomicrones?", opts: ["Transportar colesterol del h√≠gado a los tejidos", "Transportar l√≠pidos ex√≥genos (dieta) a los tejidos", "Transportar colesterol de regreso al h√≠gado", "Almacenar energ√≠a"], correct: 1, explanation: "Llevan la grasa que comemos desde el intestino hacia m√∫sculos y tejido adiposo."},
    {q: "¬øQu√© lipoprote√≠na se conoce com√∫nmente como 'colesterol malo'?", opts: ["HDL", "LDL (Lipoprote√≠na de Baja Densidad)", "Quilomicr√≥n", "Alb√∫mina"], correct: 1, explanation: "Transporta colesterol a los tejidos y su exceso se deposita en las arterias formando placas (aterosclerosis)."},
    {q: "¬øPor qu√© se considera al HDL como 'colesterol bueno'?", opts: ["Porque transporta colesterol desde los tejidos hacia el h√≠gado", "Porque tiene bajo contenido de prote√≠nas", "Porque deposita colesterol en las arterias", "Porque es rico en triglic√©ridos"], correct: 0, explanation: "Este proceso, llamado transporte reverso de colesterol, limpia las arterias."},
    {q: "¬øQu√© enzima ubicada en los capilares sangu√≠neos hidroliza los triglic√©ridos de quilomicrones y VLDL?", opts: ["Lipoprote√≠na Lipasa (LPL)", "Lipasa sensible a hormonas", "Amilasa", "Hexoquinasa"], correct: 0, explanation: "Anclada al endotelio capilar, permite que los tejidos capten √°cidos grasos de las lipoprote√≠nas circulantes."},
    {q: "¬øQu√© efecto tienen las estatinas en el metabolismo lip√≠dico?", opts: ["Inhiben la absorci√≥n intestinal de grasa", "Inhiben la enzima HMG-CoA reductasa", "Aumentan la s√≠ntesis de triglic√©ridos", "Destruyen los quilomicrones"], correct: 1, explanation: "Bloquean el paso limitante en la s√≠ntesis end√≥gena de colesterol en el h√≠gado, reduciendo as√≠ los niveles de LDL."},
    {q: "¬øQu√© factor de la membrana plasm√°tica determina principalmente su fluidez?", opts: ["La cantidad de agua", "La composici√≥n de √°cidos grasos y el contenido de colesterol", "La cantidad de carbohidratos", "El espesor de la pared celular"], correct: 1, explanation: "Cadenas cortas e insaturadas aumentan la fluidez; el colesterol la modula."},
    {q: "¬øQu√© son las 'balsas lip√≠dicas' (lipid rafts)?", opts: ["Dep√≥sitos de grasa en el tejido adiposo", "Microdominios de membrana ricos en colesterol y esfingol√≠pidos", "Ves√≠culas de transporte intracelular", "Gotas de l√≠pidos en sangre"], correct: 1, explanation: "Son zonas m√°s r√≠gidas y gruesas de la membrana que organizan prote√≠nas de se√±alizaci√≥n."},
    {q: "¬øQu√© tipo de vitamina es el beta-caroteno?", opts: ["Precursor de Vitamina A", "Vitamina C", "Vitamina B12", "Vitamina K"], correct: 0, explanation: "Es un terpeno vegetal que se escinde para formar vitamina A (retinol)."},
    {q: "¬øQu√© tipo de enlace une los √°cidos grasos al glicerol en un triacilglicerol?", opts: ["Enlace pept√≠dico", "Enlace √©ster", "Enlace glucos√≠dico", "Enlace fosfodi√©ster"], correct: 1, explanation: "Se forma entre el grupo hidroxilo del glicerol y el carboxilo del √°cido graso."},
    {q: "¬øQu√© tipo de enlace une el √°cido graso a la esfingosina en una ceramida?", opts: ["Enlace √©ster", "Enlace amida", "Enlace √©ter", "Enlace i√≥nico"], correct: 1, explanation: "El √°cido graso se une al grupo amino de la esfingosina."},
    {q: "¬øQu√© es la lecitina?", opts: ["Un nombre com√∫n para la Fosfatidilcolina", "Una prote√≠na", "Un az√∫car", "Un √°cido graso libre"], correct: 0, explanation: "Es el fosfol√≠pido m√°s abundante en membranas eucariotas."},
    {q: "La fosfatidilserina normalmente se encuentra en la cara interna de la membrana. Su exposici√≥n al exterior es una se√±al de:", opts: ["Divisi√≥n celular", "Apoptosis (muerte celular programada)", "Entrada de glucosa", "S√≠ntesis de prote√≠nas"], correct: 1, explanation: "Sirve como se√±al de 'c√≥meme' para los macr√≥fagos."},
    {q: "¬øCu√°l es la causa principal del S√≠ndrome de Dificultad Respiratoria en reci√©n nacidos prematuros?", opts: ["Falta de surfactante pulmonar (DPPC)", "Exceso de moco", "Infecci√≥n bacteriana", "Defecto card√≠aco"], correct: 0, explanation: "Sin suficiente surfactante, los alv√©olos colapsan debido a la tensi√≥n superficial del agua."},
    {q: "¬øCu√°les son ejemplos de √°cidos grasos Omega-3?", opts: ["EPA y DHA", "√Åcido oleico y palm√≠tico", "√Åcido linoleico y araquid√≥nico", "Colesterol y cortisona"], correct: 0, explanation: "√Åcido Eicosapentaenoico y Docosahexaenoico, abundantes en aceites de pescado."},
    {q: "¬øQu√© diferencia f√≠sica b√°sica existe entre aceites y grasas?", opts: ["Los aceites son l√≠quidos a temperatura ambiente, las grasas son s√≥lidas", "Los aceites son animales, las grasas vegetales", "Los aceites tienen m√°s calor√≠as", "Las grasas no tienen √°cidos grasos"], correct: 0, explanation: "Debido a la mayor proporci√≥n de insaturaciones en los aceites."},
    {q: "¬øQu√© proceso industrial convierte aceites l√≠quidos en grasas s√≥lidas, generando grasas trans?", opts: ["Hidrogenaci√≥n parcial", "Saponificaci√≥n", "Hidr√≥lisis", "Esterificaci√≥n"], correct: 0, explanation: "A√±ade hidr√≥geno para saturar enlaces, pero colateralmente isomeriza cis a trans."},
    {q: "¬øQu√© significa que una mol√©cula sea 'anfip√°tica'?", opts: ["Que tiene carga positiva y negativa", "Que tiene una regi√≥n hidrof√≠lica y una regi√≥n hidrof√≥bica", "Que es soluble en todo", "Que es inestable"], correct: 1, explanation: "Esta dualidad es esencial para formar membranas y micelas."},
    {q: "¬øQu√© estructura forman los productos de la digesti√≥n lip√≠dica en el intestino para ser absorbidos?", opts: ["Bicapas planas", "Micelas mixtas", "Cristales s√≥lidos", "Pol√≠meros largos"], correct: 1, explanation: "Esferas con el exterior polar (sales biliares) y el interior apolar (√°cidos grasos), permitiendo el transporte en el medio acuoso intestinal."},
    {q: "¬øQu√© proceso patol√≥gico se inicia con la acumulaci√≥n y oxidaci√≥n de LDL en las arterias?", opts: ["Osteoporosis", "Aterosclerosis", "Diabetes tipo 1", "Anemia"], correct: 1, explanation: "Formaci√≥n de placas de ateroma que obstruyen el flujo sangu√≠neo."},
    {q: "¬øQu√© es la dislipidemia?", opts: ["Dolor muscular", "Alteraci√≥n en los niveles de l√≠pidos en sangre", "Falta de l√≠pidos en la dieta", "Exceso de az√∫car"], correct: 1, explanation: "Incluye colesterol alto, triglic√©ridos altos o HDL bajo."},
    {q: "¬øQu√© funci√≥n tienen los leucotrienos?", opts: ["Transporte de ox√≠geno", "Mediadores de la inflamaci√≥n y la respuesta al√©rgica (broncoconstricci√≥n)", "Digesti√≥n de prote√≠nas", "Formaci√≥n de hueso"], correct: 1, explanation: "Son eicosanoides potentes implicados en el asma."}
];

// Drag & Drop EXPANDIDO (Nuevas categor√≠as y elementos)
var lipidsData = [
    // √Åcidos Grasos
    {name: "√Åcido Este√°rico (18:0)", category: "acidos_grasos"},
    {name: "√Åcido Oleico (18:1)", category: "acidos_grasos"},
    {name: "√Åcido Araquid√≥nico (20:4)", category: "acidos_grasos"},
    {name: "√Åcido Linol√©nico (Omega-3)", category: "acidos_grasos"},
    {name: "√Åcido Palm√≠tico (16:0)", category: "acidos_grasos"},
    // Membrana
    {name: "Fosfatidilcolina", category: "membrana"},
    {name: "Esfingomielina", category: "membrana"},
    {name: "Gangli√≥sido GM1", category: "membrana"},
    {name: "Cerebr√≥sido", category: "membrana"},
    {name: "Cardiolipina", category: "membrana"},
    {name: "Glucocerebr√≥sido", category: "membrana"},
    // Esteroides/Isoprenoides
    {name: "Colesterol", category: "esteroides_isoprenoides"},
    {name: "Testosterona", category: "esteroides_isoprenoides"},
    {name: "Vitamina A (Retinol)", category: "esteroides_isoprenoides"},
    {name: "Beta-caroteno", category: "esteroides_isoprenoides"},
    {name: "Vitamina D", category: "esteroides_isoprenoides"},
    {name: "Sales Biliares", category: "esteroides_isoprenoides"},
    // Almacenamiento/Ceras
    {name: "Triacilglicerol (Grasa)", category: "almacenamiento_ceras"},
    {name: "Cera de abeja", category: "almacenamiento_ceras"},
    {name: "Aceite de ma√≠z (TAG)", category: "almacenamiento_ceras"},
    {name: "Espermaceti (Cera)", category: "almacenamiento_ceras"}
];

var flashcardsData = [
    {front: "L√≠pidos", back: "Biomol√©culas insolubles en agua, solubles en solventes org√°nicos (apolares)."},
    {front: "√Åcido Graso Saturado", back: "Cadena hidrocarbonada con enlaces simples (recta). S√≥lido a T¬∞ ambiente."},
    {front: "√Åcido Graso Insaturado", back: "Tiene uno o m√°s dobles enlaces. L√≠quido a T¬∞ ambiente (si es cis)."},
    {front: "Configuraci√≥n Cis", back: "Hidr√≥genos del mismo lado del doble enlace. Causa curvatura (fluidez)."},
    {front: "Configuraci√≥n Trans", back: "Hidr√≥genos en lados opuestos. Cadena recta (r√≠gida/nociva)."},
    {front: "√Åcidos Grasos Esenciales", back: "Linoleico (œâ-6) y Alfa-linol√©nico (œâ-3). El cuerpo no los sintetiza."},
    {front: "Triacilglicerol (TAG)", back: "Glicerol + 3 √Åcidos Grasos. Principal reserva de energ√≠a."},
    {front: "Saponificaci√≥n", back: "Hidr√≥lisis alcalina de grasas para producir jab√≥n y glicerol."},
    {front: "Ceras", back: "√âsteres de √°cido graso y alcohol de cadena larga. Impermeabilizantes."},
    {front: "Fosfol√≠pidos", back: "L√≠pidos anfip√°ticos principales de membranas. Forman bicapas."},
    {front: "Anfip√°tico", back: "Mol√©cula con una parte hidrof√≠lica (polar) y otra hidrof√≥bica (apolar)."},
    {front: "Surfactante Pulmonar", back: "Rico en DPPC. Reduce tensi√≥n superficial alveolar (evita colapso)."},
    {front: "Esfingosina", back: "Aminoalcohol de cadena larga, base de los esfingol√≠pidos."},
    {front: "Ceramida", back: "Esfingosina + √Åcido Graso (unido por enlace amida)."},
    {front: "Esfingomielina", back: "Fosfol√≠pido/Esfingol√≠pido en vaina de mielina (aislante nervioso)."},
    {front: "Cerebr√≥sido", back: "Ceramida + 1 az√∫car (glucosa o galactosa)."},
    {front: "Gangli√≥sido", back: "Ceramida + Oligosac√°rido complejo con √°cido si√°lico."},
    {front: "Enfermedad de Tay-Sachs", back: "Acumulaci√≥n de Gangli√≥sido GM2 por falta de Hexosaminidasa A."},
    {front: "Enfermedad de Gaucher", back: "Acumulaci√≥n de Glucocerebr√≥sido por falta de Beta-glucosidasa."},
    {front: "Isopreno", back: "Unidad de 5 carbonos base de terpenos y esteroides."},
    {front: "Colesterol", back: "Esteroide de 27 carbonos. Regula fluidez de membrana."},
    {front: "Sales Biliares", back: "Derivados del colesterol. Emulsionan grasas en el intestino."},
    {front: "Vitamina D", back: "Derivado del colesterol sintetizado con luz UV. Regula calcio."},
    {front: "Hormonas Esteroideas", back: "Cortisol, Aldosterona, Sex hormones. Derivan del colesterol."},
    {front: "√Åcido Araquid√≥nico", back: "Precursor de eicosanoides (20 carbonos, œâ-6)."},
    {front: "Prostaglandinas", back: "Mediadores locales de inflamaci√≥n, dolor y fiebre."},
    {front: "Tromboxanos", back: "Promueven agregaci√≥n plaquetaria y vasoconstricci√≥n."},
    {front: "Leucotrienos", back: "Mediadores de asma y alergia (broncoconstricci√≥n)."},
    {front: "COX (Ciclooxigenasa)", back: "Enzima que convierte araquid√≥nico en prostaglandinas. Diana de aspirina."},
    {front: "Lipasa Pancre√°tica", back: "Enzima principal de digesti√≥n de TAGs en intestino."},
    {front: "Emulsificaci√≥n", back: "Proceso de romper grandes gotas de grasa en micelas (por bilis)."},
    {front: "Quilomicrones", back: "Transportan grasa diet√©tica (ex√≥gena) desde intestino a tejidos."},
    {front: "VLDL", back: "Transporta grasa end√≥gena (sintetizada en h√≠gado) a tejidos."},
    {front: "LDL (Malo)", back: "Transporta colesterol a tejidos. Exceso causa aterosclerosis."},
    {front: "HDL (Bueno)", back: "Transporte reverso de colesterol (tejidos -> h√≠gado)."},
    {front: "LPL (Lipoprote√≠na Lipasa)", back: "Enzima capilar que libera √°cidos grasos de quilomicrones/VLDL."},
    {front: "Aterosclerosis", back: "Acumulaci√≥n de placa lip√≠dica en paredes arteriales."},
    {front: "Estatinas", back: "F√°rmacos que inhiben HMG-CoA reductasa (bajan s√≠ntesis colesterol)."},
    {front: "Omega-3", back: "Antiinflamatorios, cardiosaludables (EPA, DHA)."},
    {front: "Fosfatidilserina", back: "En cara interna membrana. Si sale, se√±ala apoptosis ('c√≥meme')."}
];

var achievements = {
    1: {icon: "üéì", title: "Primer Paso", desc: "Primera pregunta contestada", points: 10},
    2: {icon: "üìö", title: "Dedicado", desc: "10 preguntas completadas", points: 50},
    3: {icon: "‚ö°", title: "Quiz Master", desc: "Quiz sin errores", points: 100},
    4: {icon: "üéØ", title: "Tax√≥nomo", desc: "Clasificaci√≥n completada", points: 75},
    5: {icon: "üß™", title: "Cient√≠fico", desc: "Simulador explorado", points: 50},
    6: {icon: "üíØ", title: "Medio Camino", desc: "50% de progreso", points: 150},
    7: {icon: "üî¨", title: "Analista", desc: "Desarrollo completo", points: 200},
    8: {icon: "üöÄ", title: "Pr√°ctico", desc: "Aplicaci√≥n completa", points: 200},
    9: {icon: "üëë", title: "Experto", desc: "Todo completado", points: 500},
    10: {icon: "‚≠ê", title: "Leyenda", desc: "Puntuaci√≥n m√°xima", points: 1000}
};

// ============================================
// L√ìGICA SIMULADOR Y APP
// ============================================
const lipidSim = {
    currentType: 'saturado',
    data: {
        saturado: {name:'Saturado', fluidity:15, spacing:'Muy Denso', packing:'M√°ximo', temp:'69¬∞C', color:'#15803d', warning:false, animClass:'fluid-low'},
        cis: {name:'Cis (Insaturado)', fluidity:90, spacing:'Amplio', packing:'Bajo', temp:'13¬∞C', color:'#2563eb', warning:false, animClass:'fluid-high'},
        trans: {name:'Trans (Industrial)', fluidity:25, spacing:'Denso', packing:'Alto', temp:'44¬∞C', color:'#dc2626', warning:true, animClass:'fluid-low'},
        colesterol: {name:'Colesterol', fluidity:50, spacing:'Medio', packing:'Regulado', temp:'148¬∞C', color:'#7c3aed', warning:false, animClass:'fluid-med'},
        mixto: {name:'Membrana Real', fluidity:65, spacing:'√ìptimo', packing:'Medio', temp:'Din√°mico', color:'#4b5563', warning:false, animClass:'fluid-med'}
    },
    selectLipid: function(t) {
        this.currentType = t;
        document.querySelectorAll('.lipid-btn').forEach(b => b.classList.remove('active'));
        document.getElementById('btn-'+t).classList.add('active');
        this.renderSim(t); this.updateInfo(t); unlockAchievement(5);
        this.updateStructure(t);
    },
    updateStructure: function(type) {
        const svg = document.getElementById('structure-svg');
        svg.innerHTML = ''; 
        const color = this.data[type].color;
        
        // Helper to draw zigzag carbon chain
        const drawZigZag = (startX, startY, segments, angle, isTrans=false) => {
            let d = `M ${startX} ${startY}`;
            let x = startX, y = startY;
            const segLen = 15;
            for(let i=0; i<segments; i++) {
                x += segLen;
                y += (i%2===0 ? -5 : 5);
                d += ` L ${x} ${y}`;
            }
            const path = document.createElementNS("http://www.w3.org/2000/svg", 'path');
            path.setAttribute('d', d);
            path.setAttribute('fill', 'none');
            path.setAttribute('stroke', color);
            path.setAttribute('stroke-width', '4');
            path.setAttribute('stroke-linecap', 'round');
            path.setAttribute('stroke-linejoin', 'round');
            return path;
        };

        const head = document.createElementNS("http://www.w3.org/2000/svg", 'circle');
        head.setAttribute('cx', 30); head.setAttribute('cy', 125); head.setAttribute('r', 12);
        head.setAttribute('fill', '#fbbf24');
        svg.appendChild(head);

        if(type === 'saturado') {
            svg.appendChild(drawZigZag(42, 125, 14, 0));
            // Add Text
            const t = document.createElementNS("http://www.w3.org/2000/svg", 'text');
            t.setAttribute('x', 150); t.setAttribute('y', 200); t.setAttribute('text-anchor', 'middle');
            t.textContent = "Cadena Saturada (Recta)"; t.setAttribute('fill', '#374151');
            svg.appendChild(t);
        } else if (type === 'cis') {
            // Part 1
            const p1 = document.createElementNS("http://www.w3.org/2000/svg", 'path');
            p1.setAttribute('d', 'M 42 125 L 57 120 L 72 125 L 87 120 L 102 125'); // Approx zigzag
            p1.setAttribute('stroke', color); p1.setAttribute('stroke-width', '4'); p1.setAttribute('fill','none');
            svg.appendChild(p1);
            // Double bond bend
            const p2 = document.createElementNS("http://www.w3.org/2000/svg", 'path');
            p2.setAttribute('d', 'M 102 125 L 120 150 L 135 145 L 150 155'); // Bending down
            p2.setAttribute('stroke', color); p2.setAttribute('stroke-width', '4'); p2.setAttribute('fill','none');
            svg.appendChild(p2);
             const t = document.createElementNS("http://www.w3.org/2000/svg", 'text');
            t.setAttribute('x', 150); t.setAttribute('y', 200); t.setAttribute('text-anchor', 'middle');
            t.textContent = "Doble Enlace Cis (Quiebre)"; t.setAttribute('fill', '#374151');
            svg.appendChild(t);
        } else if (type === 'trans') {
             // Zigzag straight but with double bond
            const p = document.createElementNS("http://www.w3.org/2000/svg", 'path');
            let d = 'M 42 125';
            let y = 125;
            for(let i=0; i<14; i++){
                d += ` L ${42 + (i+1)*15} ${y + (i%2===0?-5:5)}`;
            }
            p.setAttribute('d', d);
            p.setAttribute('stroke', color); p.setAttribute('stroke-width', '4'); p.setAttribute('fill','none');
            svg.appendChild(p);
            // Double bond marker
            const db = document.createElementNS("http://www.w3.org/2000/svg", 'line');
            db.setAttribute('x1', 110); db.setAttribute('y1', 115); db.setAttribute('x2', 125); db.setAttribute('y2', 125);
            db.setAttribute('stroke', 'red'); db.setAttribute('stroke-width', '2');
            svg.appendChild(db);
             const t = document.createElementNS("http://www.w3.org/2000/svg", 'text');
            t.setAttribute('x', 150); t.setAttribute('y', 200); t.setAttribute('text-anchor', 'middle');
            t.textContent = "Trans (Recta - Falso Saturado)"; t.setAttribute('fill', '#dc2626');
            svg.appendChild(t);
        } else if (type === 'colesterol') {
            // 4 rings
            const g = document.createElementNS("http://www.w3.org/2000/svg", 'g');
            g.setAttribute('transform', 'translate(60,80) scale(1.5)');
            const rings = document.createElementNS("http://www.w3.org/2000/svg", 'path');
            rings.setAttribute('d', 'M0 20 L15 10 L30 20 L15 30 Z M30 20 L45 10 L60 20 L45 30 Z M60 20 L75 10 L90 20 L75 30 Z M75 10 L75 -5 L90 5'); // Simplified steroid nucleus
            rings.setAttribute('fill', 'none'); rings.setAttribute('stroke', color); rings.setAttribute('stroke-width', '2');
            g.appendChild(rings);
            svg.appendChild(g);
             const t = document.createElementNS("http://www.w3.org/2000/svg", 'text');
            t.setAttribute('x', 150); t.setAttribute('y', 200); t.setAttribute('text-anchor', 'middle');
            t.textContent = "Anillos R√≠gidos"; t.setAttribute('fill', '#374151');
            svg.appendChild(t);
        }
    },
    renderSim: function(t) {
        const b = document.getElementById('bilayer'); b.innerHTML='';
        const d = this.data[t];
        let types = [];
        for(let i=0;i<14;i++) types.push(t==='mixto' ? (Math.random()<.4?'saturado':Math.random()<.8?'cis':'colesterol') : t);
        
        const up = document.createElement('div'); up.className='layer upper';
        const down = document.createElement('div'); down.className='layer';
        
        types.forEach(type => {
            up.appendChild(this.createMol(type));
            down.appendChild(this.createMol(type));
        });
        b.appendChild(up); b.appendChild(down);
        
        document.getElementById('fluidity-fill').style.width = d.fluidity+'%';
        document.getElementById('fluidity-text-val').textContent = d.fluidity<40?'Baja':d.fluidity>80?'Alta':'Media';
    },
    createMol: function(t) {
        const m = document.createElement('div'); m.className=`lipid-molecule ${this.data[t].animClass}`;
        const h = document.createElement('div'); h.className='head';
        if(t==='colesterol') h.style.background='#ddd6fe';
        const tc = document.createElement('div'); tc.className='tail-container';
        if(t==='colesterol') {
            const tl = document.createElement('div'); tl.className='tail cholesterol'; tc.appendChild(tl);
        } else {
            const t1 = document.createElement('div'); t1.className=`tail ${t==='saturado'||t==='trans'?'straight':'cis'}`;
            const t2 = document.createElement('div'); t2.className=`tail ${t==='trans'?'trans':(t==='saturado'?'straight':'cis')}`;
            if(t==='cis') t2.style.transform='rotate(-20deg) translateX(-3px)';
            tc.appendChild(t1); tc.appendChild(t2);
        }
        m.appendChild(h); m.appendChild(tc);
        return m;
    },
    updateInfo: function(t) {
        const d = this.data[t];
        document.getElementById('lipid-info').innerHTML = `<div class="info-panel ${d.warning?'warning':''}"><strong>${d.name}</strong><br>P. Fusi√≥n: ${d.temp} | Empaque: ${d.packing}</div>`;
    }
};

function init() {
    saveSystem.init();
    lipidSim.selectLipid('saturado');
    renderQuizzes(); renderDragDrop(); renderFlashcards(); renderPreguntas();
    updateStats();
    setTimeout(() => { document.getElementById('loading').classList.add('hidden'); document.getElementById('app').classList.remove('hidden'); }, 500);
}

function showTab(t) {
    currentTab = t;
    document.querySelectorAll('.tab').forEach(x => x.classList.remove('active'));
    document.querySelectorAll('.tab-content').forEach(x => x.classList.add('hidden'));
    document.querySelector(`.tab[onclick="showTab('${t}')"]`).classList.add('active');
    document.getElementById('tab-'+t).classList.remove('hidden');
    if(t==='ejercicios') renderPreguntas();
}

// Renderizados
function renderQuizzes() {
    let h = '';
    quizzes.forEach((q,i) => {
        h += `<div class="quiz-question" id="quiz-${i}"><div class="quiz-q">${i+1}. ${q.q}</div>`;
        q.opts.forEach((o,j) => h+=`<div class="quiz-option" onclick="checkQuiz(${i},${j})">${o}</div>`);
        h += `<div id="qfeed-${i}" class="quiz-feedback"></div></div>`;
    });
    document.getElementById('quiz-container').innerHTML = h;
}
function checkQuiz(i,j) {
    const q = quizzes[i];
    const feed = document.getElementById(`qfeed-${i}`);
    const opts = document.querySelectorAll(`#quiz-${i} .quiz-option`);
    opts.forEach(o => o.style.pointerEvents='none');
    
    if(j===q.correct) {
        opts[j].classList.add('correct'); feed.className='quiz-feedback correct';
        feed.innerHTML = `<strong>¬°Correcto!</strong> ${q.explanation}`;
        addPoints(10);
    } else {
        opts[j].classList.add('incorrect'); opts[q.correct].classList.add('correct');
        feed.className='quiz-feedback incorrect';
        feed.innerHTML = `<strong>Incorrecto.</strong> ${q.explanation}`;
    }
    saveSystem.save(true);
}

function renderDragDrop() {
    let h = '';
    lipidsData.forEach((l,i) => h+=`<div class="draggable" draggable="true" id="d-${i}" data-cat="${l.category}">${l.name}</div>`);
    document.getElementById('draggables-lipids').innerHTML = h;
    
    document.querySelectorAll('.draggable').forEach(d => {
        d.addEventListener('dragstart', e => e.dataTransfer.setData('id', e.target.id));
    });
    document.querySelectorAll('.drop-zone').forEach(z => {
        z.addEventListener('dragover', e => { e.preventDefault(); z.classList.add('over'); });
        z.addEventListener('dragleave', () => z.classList.remove('over'));
        z.addEventListener('drop', e => {
            e.preventDefault(); z.classList.remove('over');
            const id = e.dataTransfer.getData('id');
            z.querySelector('.drop-items').appendChild(document.getElementById(id));
        });
    });
}
function checkDragDrop() {
    let ok = 0;
    document.querySelectorAll('.draggable').forEach(d => {
        const z = d.parentElement.parentElement;
        if(z.dataset.category === d.dataset.cat) {
            d.classList.add('placed'); d.draggable=false; ok++;
            d.style.border='1px solid #22c55e';
        } else {
            d.style.border='1px solid #ef4444';
        }
    });
    addPoints(ok*5);
    if(ok === lipidsData.length) unlockAchievement(4);
    alert(`Clasificaste ${ok} correctamente.`);
    saveSystem.save(true);
}
function resetDragDrop() { renderDragDrop(); }

function renderPreguntas() {
    let h = '';
    // Preliminares
    h += `<div class="card"><div class="card-header">3.0 Preliminares</div><div class="question-list">`;
    preguntasData.pre.forEach((p,i) => h += mkQ(`pre-${i}`, p, i+1));
    h += `</div></div>`;
    
    // Secciones
    const secs = ['sec31','sec32','sec33','sec34','sec35','sec36','sec37','sec38'];
    secs.forEach(k => {
        const s = preguntasData[k];
        h += `<div class="card"><div class="card-header">${s.titulo}</div><div class="question-list">`;
        h += `<h4 style="color:#6b7280;margin-bottom:1rem">Desarrollo</h4>`;
        s.dev.forEach((p,i) => h += mkQ(`${k}-d-${i}`, p, i+1));
        if(s.app.length) {
            h += `<h4 style="color:#6b7280;margin:1.5rem 0 1rem 0;border-top:1px solid #eee;padding-top:1rem">Aplicaci√≥n</h4>`;
            s.app.forEach((p,i) => h += mkQ(`${k}-a-${i}`, p, i+1));
        }
        h += `</div></div>`;
    });
    
    // Caso
    const c = preguntasData.caso;
    h += `<div class="card"><div class="card-header" style="background:#fff7ed;color:#9a3412">${c.titulo}</div><div class="question-list">`;
    c.dev.forEach((p,i) => h += mkQ(`caso-${i}`, p, i+1));
    h += `</div></div>`;
    
    document.getElementById('preguntas-container').innerHTML = h;
}
function mkQ(id, txt, n) {
    const val = respuestas[id] || '';
    const cls = val.length > 10 ? 'completed' : '';
    return `<div class="question-item ${cls}" id="q-${id}"><span class="question-text">${n}. ${txt}</span><textarea oninput="saveAns('${id}',this.value)">${val}</textarea></div>`;
}
function saveAns(id, val) {
    respuestas[id] = val;
    const el = document.getElementById('q-'+id);
    if(val.length > 10) el.classList.add('completed'); else el.classList.remove('completed');
    saveSystem.save(true);
    
    let total = 0, done = 0;
    for(let k in preguntasData) {
        if(Array.isArray(preguntasData[k])) total += preguntasData[k].length;
        else total += (preguntasData[k].dev.length + preguntasData[k].app.length);
    }
    for(let k in respuestas) if(respuestas[k].length>10) done++;
    if(done > 10) unlockAchievement(2);
    if(done > total*0.5) unlockAchievement(6);
}

// Logros y Stats
function addPoints(p) { userStats.points += p; updateStats(); }
function unlockAchievement(id) {
    if(userStats.achievements[id]) return;
    userStats.achievements[id] = true;
    userStats.badges++;
    addPoints(achievements[id].points);
    const m = document.getElementById('achievement-modal');
    document.getElementById('modal-title').innerText = achievements[id].title;
    document.getElementById('modal-description').innerText = achievements[id].desc;
    document.getElementById('modal-points').innerText = achievements[id].points;
    document.getElementById('modal-badge').innerText = achievements[id].icon;
    m.classList.add('show');
}
function closeAchievementModal() { document.getElementById('achievement-modal').classList.remove('show'); }
function updateStats() {
    document.getElementById('stat-points').innerText = userStats.points;
    document.getElementById('stat-badges').innerText = userStats.badges + '/10';
    document.getElementById('progress-fill').style.width = Math.min(100, (userStats.points/1000)*100) + '%';
}

// Flashcards
function renderFlashcards() {
    let h = '';
    flashcardsData.forEach(c => {
        h += `<div class="flashcard" onclick="this.classList.toggle('flipped')">
            <div class="flashcard-icon">üß¨</div>
            <div class="flashcard-front">${c.front}</div>
            <div class="flashcard-back">${c.back}</div>
            <div style="margin-top:1rem;font-size:0.75rem;color:#9ca3af;text-transform:uppercase;letter-spacing:1px">Click para voltear</div>
        </div>`;
    });
    document.getElementById('flashcard-container').innerHTML = h;
}

// Calculadora Iodine
function calculateIodine() {
    const v = document.getElementById('calc-fatty-acid').value;
    const r = document.getElementById('calc-result');
    
    if(v === "") { 
        r.style.display='none'; 
        return; 
    }
    
    r.style.display='block';
    document.getElementById('calc-value').innerText = "√çndice: " + v;
    
    let interp = "";
    if(v == 0) interp = "Saturado (Sin dobles enlaces)";
    else if(v < 100) interp = "Monoinsaturado (1 doble enlace)";
    else interp = "Poliinsaturado (M√∫ltiples dobles enlaces)";
    
    document.getElementById('calc-interpretation').innerText = interp;
}

// Calculadora Melting Point
function calculateMeltingPoint() {
    const c = parseInt(document.getElementById('calc-chain-length').value) || 0;
    const b = parseInt(document.getElementById('calc-double-bonds').value) || 0;
    const cfg = document.getElementById('calc-config').value;
    
    // Algoritmo simplificado para prop√≥sitos educativos
    // Base: 18:0 (Este√°rico) es approx 70¬∞C. 
    // Cada carbono extra a√±ade ~2-3¬∞C (simplificado).
    // Cada doble enlace CIS reduce dr√°sticamente (~ -30¬∞C el primero, menos los siguientes).
    // Trans reduce mucho menos.
    
    let baseline = 70; // Para C18
    let carbonEffect = (c - 18) * 5; // Ajuste por longitud
    
    let bondEffect = 0;
    if (b > 0) {
        if (cfg === 'cis') {
            bondEffect = -(b * 25); // Cis baja mucho el PF
            if(b > 1) bondEffect -= 10; // Efecto acumulativo
        } else {
            bondEffect = -(b * 5); // Trans baja poco (se parece a saturado)
        }
    }
    
    let mp = baseline + carbonEffect + bondEffect;
    
    // Limites l√≥gicos para la demo
    if (c < 4) mp = -50; 
    
    const valEl = document.getElementById('calc-mp-value');
    const stateEl = document.getElementById('calc-mp-state');
    const intEl = document.getElementById('calc-mp-interpretation');
    const resEl = document.getElementById('calc-mp-result');
    
    valEl.innerText = "~" + mp.toFixed(1) + " ¬∞C";
    
    if(mp > 25) {
        stateEl.innerText = "üß±";
        intEl.innerText = "S√≥lido a temperatura ambiente (25¬∞C)";
        intEl.style.color = "#b91c1c"; // Rojo/Duro
    } else {
        stateEl.innerText = "üíß";
        intEl.innerText = "L√≠quido a temperatura ambiente (25¬∞C)";
        intEl.style.color = "#0369a1"; // Azul/Liquido
    }
}

document.addEventListener('DOMContentLoaded', init);
</script>
</body>
</html>
